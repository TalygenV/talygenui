(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-ac55f698"],{"0edb":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t._self._c;return e("div",[e("section",{staticClass:"page-action"},[e("loader",{attrs:{"is-visible":t.isLoading}}),e("Form",{ref:"AddInvoice",staticClass:"row",scopedSlots:t._u([{key:"default",fn:function({valid:a,errors:s}){return[e("div",{staticClass:"container-fluid"},[e("div",{staticClass:"row"},[e("div",{staticClass:"col-md-12 padding-t_8"},[e("div",{staticClass:"theme-primary partition-full"},[e("span",{staticClass:"p-name text-white"},[t._v(t._s("Create"==t.Formtype?" Add Invoice":"Edit Client Invoice"))]),e("span",{staticClass:"p-actions float-right"},[e("router-link",{staticClass:"p-action-btn text-white d-none d-md-inline-block",attrs:{to:"/ClientBill/Index","data-toggle-tooltip":"tooltip","data-original-title":"Back to list"}},[e("i",{staticClass:"fa fa-angle-double-left",attrs:{"aria-hidden":"true"}}),e("br"),t._v(" "+t._s(t.$t("BacktoList"))+" ")])],1)])])]),e("div",{staticClass:"container-fluid p-0"},[e("div",{staticClass:"border p-3"},[e("div",{staticClass:"row"},[e("InvoiceFields",{attrs:{InvoiceFieldsDetails:t.InvoiceFieldsDetails,Formtype:t.Formtype},on:{emailDetail:t.selectedEmailDetail,InvoiceFieldsChange:t.handleInvoiceFieldsChange,recurringChange:t.handleRecurring}})],1),t.Reccuring?e("Reccuring",{attrs:{emailDetail:t.emailDetail,recurringItemsDetails:t.recurringItemsDetails,Formtype:t.Formtype},on:{RecurringFieldsChange:t.handleRecurringFieldsChange}}):t._e(),e("InvoiceItems",{attrs:{invoiceItemDetails:t.invoiceItemDetails,discountDetails:t.discountDetails,taxDetails:t.taxDetails,InvoiceFieldsDetails:t.InvoiceFieldsDetails},on:{InvoiceItemsDetails:t.handleInvoiceItemsDetails,DiscountItemsDetails:t.handleDiscountItems,TaxItemsDetails:t.handleTaxItems}}),e("div",{staticClass:"row flex-row-reverse mt-3"},[e("div",{staticClass:"col-lg-6 text-right"},[e("a",{staticClass:"btn btn-success mr-2",attrs:{"data-tour":"step: 1; title: Enter Invoice Detail; content: Enter invoice detail and then save.",href:"javascript:;",id:"aSave"},on:{click:function(e){return t.saveInvoiceDetails(a,s)}}},[e("i",{staticClass:"fa fa-save pr-2"}),t._v(t._s("Create"==t.Formtype?"Save":"Update")+" ")]),e("router-link",{staticClass:"btn btn-danger",attrs:{to:"/ClientBill/Index",title:"","data-toggle":"tooltip","data-original-title":"Cancel"}},[e("i",{staticClass:"fa fa-close pr-2"}),t._v(" "+t._s(t.$t("Cancel"))+" ")])],1),e("div",{staticClass:"col-lg-6"},[e("div",{staticClass:"py-2"},[e("span",{staticClass:"mandatory"},[t._v("Fields marked with an asterisk (*) are mandatory.")])])])])],1)])])]}}])})],1)])},i=[],l=(a("14d9"),a("9769")),o=function(){var t=this,e=t._self._c;return e("div",{staticClass:"col-lg-12"},["Create"==t.Formtype?e("div",{staticClass:"heading-border mb-3"},[e("h5",{staticClass:"h5"},[e("span",{staticClass:"d-md-inline-block"},[e("div",{staticClass:"custom-control custom-checkbox"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.recurring,expression:"recurring"}],staticClass:"isRecurring custom-control-input",attrs:{type:"checkbox",id:"chkAll_11",name:"checkbox"},domProps:{checked:Array.isArray(t.recurring)?t._i(t.recurring,null)>-1:t.recurring},on:{click:function(e){return t.changeRecurring(e)},change:function(e){var a=t.recurring,s=e.target,i=!!s.checked;if(Array.isArray(a)){var l=null,o=t._i(a,l);s.checked?o<0&&(t.recurring=a.concat([l])):o>-1&&(t.recurring=a.slice(0,o).concat(a.slice(o+1)))}else t.recurring=i}}}),e("label",{staticClass:"custom-control-label universal-custom-control-label pt-1",attrs:{for:"chkAll_11"}})]),t._v(" "+t._s(t.$t("Recurring"))+" ")])])]):t._e(),e("dynamic-form",{ref:"invoiceFields",attrs:{lang:"en",buttons:!1,schema:t.FormSchema},scopedSlots:t._u([{key:"tgslot-Invoice_Number",fn:function({data:a}){return[e("Field",{attrs:{name:"Invoice_Number",rules:{required:!1}},scopedSlots:t._u([{key:"default",fn:function({errors:s}){return[e("div",{staticClass:"input-group bg-white"},[e("input",{directives:[{name:"model",rawName:"v-model",value:a.fieldInfo.value,expression:"data.fieldInfo.value"}],class:{"form-control":!0,"is-invalid":s[0]||!1},attrs:{type:"text",id:"",disabled:!0},domProps:{value:a.fieldInfo.value},on:{input:function(e){e.target.composing||t.$set(a.fieldInfo,"value",e.target.value)}}})]),"Create"==t.Formtype?e("small",[0==t.isHideMessage?e("a",{staticClass:"text-primary",on:{click:t.toggleMode}},[t._v(" "+t._s(t.modeText)+" ")]):t._e()]):t._e(),e("span",{staticClass:"text-primary",attrs:{else:""}})]}}],null,!0)})]}},{key:"tgslot-Project",fn:function({data:a}){return[e("div",{staticClass:"input-group"},[e("MutliSelectDropDown",{attrs:{options:t.filteredOptions,value:t.selectedProjects,placeholder:"Select Project",searchable:!0,searchPlaceholder:"Search Project",maxItems:3,selectAllEnabled:!0,allText:"Select All",Formtype:t.Formtype},on:{input:t.updateSelectedProjects}})],1)]}},{key:"tgslot-Template",fn:function({data:a}){return[e("Field",{staticClass:"w-100",attrs:{name:"Template",rules:{required:!0}},scopedSlots:t._u([{key:"default",fn:function({errors:s}){return[e("div",{staticClass:"form-group"},[e("div",{staticClass:"input-group mb-3"},[e("select",{directives:[{name:"model",rawName:"v-model",value:a.fieldInfo.value,expression:"data.fieldInfo.value"}],class:{"form-control":!0,"is-invalid":s[0]},attrs:{name:"Template"},on:{change:[function(e){var s=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(a.fieldInfo,"value",e.target.multiple?s:s[0])},function(e){return t.handleTemplateChange(a.fieldInfo.value)}]}},[e("option",{attrs:{value:""}},[t._v(t._s(t.$t("Select")))]),t._l(t.templateList,(function(a,s){return e("option",{key:s,domProps:{value:a.value}},[t._v(" "+t._s(a.name))])}))],2),e("div",{staticClass:"input-group-append"},[e("span",{staticClass:"input-group-text"},[e("a",{staticClass:"text-dark",attrs:{id:"linkPreviewtemplate",href:"javascript:;","data-toggle":"tooltip",title:"","data-toggle-tooltip":"tooltip","data-original-title":"View Template"},on:{click:function(e){return t.previewTemplate()}}},[e("i",{staticClass:"fa fa-eye"})])])]),s[0]?e("span",{staticClass:"invalid-feedback d-block",attrs:{name:"Template"}},[t._v(t._s(s[0]))]):t._e()])])]}}],null,!0)})]}}])}),t.isViewTemplate?e("TemplateReview",{attrs:{PreviewTemplate:t.previewTemplateContent}}):t._e()],1)},r=[],n=function(){var t=this,e=t._self._c;return e("div",{ref:"dropdown",class:{tt_addcategory_ddl:!0,"multiselect-dropdown":!0,disabled:"Create"!=t.Formtype},on:{click:t.toggleDropdown}},[0===t.selectedOptions.length?e("span",{staticClass:"placeholder"},[t._v(t._s(t.placeholder))]):e("span",[t._l(t.visibleSelectedOptions,(function(a,s){return e("span",{key:a.value,staticClass:"optext"},[t._v(" "+t._s(a.label)+" "),e("span",{staticClass:"optdel",on:{click:function(e){return e.stopPropagation(),t.removeOption(s)}}},[t._v("ðŸ—™")])])})),t.hiddenOptionsCount>0?e("span",{staticClass:"more-indicator text-primary",on:{click:t.toggleDropdown}},[t._v(" +"+t._s(t.hiddenOptionsCount)+" more ")]):t._e(),e("span",{staticClass:"ttddl_clearall bg-danger",on:{click:t.clearAll}},[e("i",{staticClass:"fa fa-refresh"})])],2),e("div",{staticClass:"multiselect-dropdown-list-wrapper"},[t.isVisibleSearchInput?e("input",{directives:[{name:"model",rawName:"v-model",value:t.searchQuery,expression:"searchQuery"}],staticClass:"multiselect-dropdown-search",attrs:{type:"text",placeholder:t.searchPlaceholder},domProps:{value:t.searchQuery},on:{input:function(e){e.target.composing||(t.searchQuery=e.target.value)}}}):t._e(),t.showDropdown?e("div",{staticClass:"multiselect-dropdown-list"},[t.selectAllEnabled&&t.filteredOptions.length>1?e("div",{staticClass:"multiselect-dropdown-all-selector",on:{click:t.toggleSelectAll}},[e("div",{staticClass:"form-check form-check-inline p-0"},[e("div",{staticClass:"custom-control custom-checkbox"},[e("input",{staticClass:"chkItems custom-control-input",attrs:{type:"checkbox"},domProps:{checked:t.isAllSelected}}),e("label",{staticClass:"custom-control-label universal-custom-control-label pt-1",attrs:{for:"allCheck"}})])]),e("label",[t._v(t._s(t.allText))])]):t._e(),0===t.filteredOptions.length?e("div",{staticClass:"no-records-found"},[t._v(" No records found ")]):t._l(t.filteredOptions,(function(a){return e("div",{key:a.value,staticClass:"multiselect-dropdown-single-selector",class:{checked:t.isSelected(a)},on:{click:function(e){return t.toggleOption(a)}}},[e("div",{staticClass:"form-check form-check-inline p-0"},[e("div",{staticClass:"custom-control custom-checkbox"},[e("input",{staticClass:"chkItems custom-control-input",attrs:{type:"checkbox"},domProps:{checked:t.isSelected(a)}}),e("label",{staticClass:"custom-control-label universal-custom-control-label pt-1",attrs:{for:"allCheck"}})])]),e("label",{staticClass:"p-1"},[t._v(t._s(a.label))])])}))],2):t._e()])])},c=[],d={name:"MultiselectDropdown",props:{options:{type:Array,required:!0},value:{type:Array,default:()=>[]},placeholder:{type:String,default:"Select"},searchable:{type:Boolean,default:!0},searchPlaceholder:{type:String,default:"Search"},maxItems:{type:Number,default:3},selectAllEnabled:{type:Boolean,default:!0},allText:{type:String,default:"Select All"},Formtype:{type:String,required:!0}},data(){return{showDropdown:!1,searchQuery:"",selectedOptions:[...this.value],isVisibleSearchInput:!1}},computed:{visibleSelectedOptions(){return this.selectedOptions.slice(0,this.maxItems)},hiddenOptionsCount(){return this.selectedOptions.length-this.maxItems},filteredOptions(){const t=this.searchQuery.trim().toLowerCase();return this.options.filter(e=>e.label.toLowerCase().includes(t))},isAllSelected(){return this.filteredOptions.length>0&&this.filteredOptions.every(t=>this.selectedOptions.includes(t))}},methods:{toggleDropdown(){0==this.isVisibleSearchInput?(this.isVisibleSearchInput=!0,this.showDropdown=!0):1==this.showDropdown?this.showDropdown=!0:this.showDropdown=!1,this.searchQuery=""},toggleOption(t){const e=this.selectedOptions.findIndex(e=>e.value===t.value);e>-1?this.selectedOptions.splice(e,1):(this.showDropdown=!0,this.searchQuery="",this.isVisibleSearchInput=!0,this.selectedOptions.push(t)),this.$emit("input",this.selectedOptions,t)},removeOption(t){this.selectedOptions.splice(t,1),this.$emit("input",this.selectedOptions)},isSelected(t){return this.selectedOptions.some(e=>e.value===t.value)},toggleSelectAll(){let t;this.isAllSelected?this.selectedOptions=[]:(t=this.filteredOptions.filter(t=>!this.isSelected(t)),this.selectedOptions=[...this.selectedOptions,...t]),this.$emit("input",this.selectedOptions)},closedropdown(){this.showDropdown=!1,this.isVisibleSearchInput=!1},clearAll(){this.selectedOptions=[],this.$emit("input",this.selectedOptions)},handleClickOutside(t){const e=this.$refs.dropdown;e&&!e.contains(t.target)&&this.closedropdown()}},watch:{value(t){this.selectedOptions=[...t]}},mounted(){document.addEventListener("click",this.handleClickOutside)},beforeDestroy(){document.removeEventListener("click",this.handleClickOutside)}},u=d,p=(a("e89e"),a("2877")),m=Object(p["a"])(u,n,c,!1,null,null,null),v=m.exports,h=function(){var t=this,e=t._self._c;return e("section",[e("div",{staticClass:"my-popups"},[e("loader",{attrs:{"is-visible":t.isLoading}}),e("div",{staticClass:"modal d-block"},[e("div",{staticClass:"modal-dialog modal-dialog-centered"},[e("div",{staticClass:"modal-content"},[e("div",{staticClass:"modal-header theme-primary partition-full d-flex align-items-center"},[e("h4",{staticClass:"modal-title"},[t._v(t._s(t.$t("TemplateReview")))]),e("button",{staticClass:"close",attrs:{type:"button","aria-label":"Close"},on:{click:t.closeTemplateReview}},[e("em",{staticClass:"fa fa-times",attrs:{"aria-hidden":"true"}})])]),e("div",{staticClass:"modal-body"},[e("div",{staticClass:"table-responsive",staticStyle:{background:"#fff"}},[t.PreviewTemplate&&""!==t.PreviewTemplate.trim()?e("div",{domProps:{innerHTML:t._s(t.PreviewTemplate)}}):e("div",{staticClass:"text-center text-danger no-record"},[t._v(" "+t._s(t.noRecordMessage)+" ")])])]),e("div",{staticClass:"modal-footer"},[e("button",{staticClass:"btn btn-danger",attrs:{type:"button"},on:{click:t.closeTemplateReview}},[e("i",{staticClass:"fa fa-close pr-2"}),t._v("Close ")])])])])])],1)])},f=[],g={props:{PreviewTemplate:{type:String,required:!1,default:""}},data(){return{isLoading:!1,templateContent:"",noRecordMessage:"No record found"}},watch:{PreviewTemplate(t){this.templateContent=t}},created(){console.log("Templates loaded successfully:",this.PreviewTemplate)},methods:{closeTemplateReview(){this.$parent.isViewTemplate=!1}}},y=g,b=(a("17de"),Object(p["a"])(y,h,f,!1,null,"3cb7b2c0",null)),C=b.exports,D={components:{MutliSelectDropDown:v,TemplateReview:C},computed:{checkMode(){return 0!=this.isDraftMode},labelText(){return this.isDraftMode?"Invoice Number":" Bill Status"},modeText(){return this.isDraftMode?"Switch to Draft Mode":"Click to generate Invoice Number"}},props:{InvoiceFieldsDetails:{type:Object},Formtype:{type:String}},watch:{InvoiceFieldsDetails(t,e){this.fieldsDetails()}},data(){return{isDraftMode:!1,Bill_To:"",recurring:!1,selectedProjects:[],isHideMessage:!1,filteredOptions:[],templateList:[],TemplateId:"",isViewTemplate:!1,previewTemplateContent:"",FormSchema:[{layoutType:"four",Data:[{astype:"SelectField",label:this.$t("BillTo"),name:"Bill_To",value:"",config:{options:[],onChange:this.projectListByClientId},placeholder:this.$t("Bill To"),validationRules:{required:!0,max:100},disabled:!1},{astype:"SlotField",label:this.$t("InvoiceStatus"),name:"Invoice_Number",value:"Draft Mode",config:{options:[]},placeholder:this.$t("InvoiceStatus"),validationRules:{required:!1,max:100},disabled:!1},{astype:"SlotField",label:this.$t("Project"),name:"Project",value:"",mode:"tag",config:{options:[],showAddIcon:!1},placeholder:this.$t("Project"),validationRules:{required:!1,max:100},disabled:!1},{astype:"DateField",label:this.$t("DateFrom"),name:"Date_From",value:"",placeholder:"",config:{format:"MM/DD/YYYY",onChange:this.setDateForm,minDate:""},validationRules:{required:!0},disabled:!1},{astype:"DateField",label:this.$t("DateTo"),name:"Date_To",value:"",placeholder:"",config:{format:"MM/DD/YYYY",onChange:this.InvoiceComponentFieldsValues,minDate:""},validationRules:{required:!0},disabled:!1},{astype:"DateField",label:this.$t("InvoiceBillIssueDate"),name:"Issue_Date",value:"",placeholder:"",config:{format:"MM/DD/YYYY",onChange:this.InvoiceComponentFieldsValues,maxDate:!1},validationRules:{required:!0},disabled:!1},{astype:"DateField",label:this.$t("DueDate"),name:"Due_Date",value:"",placeholder:"",config:{format:"MM/DD/YYYY",onChange:this.InvoiceComponentFieldsValues},validationRules:{required:!0},disabled:!1},{astype:"SlotField",label:this.$t("Template"),name:"Template",value:"",config:{options:[],onChange:this.InvoiceComponentFieldsValues},placeholder:this.$t("Template"),validationRules:{required:!0,max:100}},{astype:"TextField",label:"Due Date Comment",name:"Due_Date_Comment",value:"",placeholder:"",config:{onChange:this.InvoiceComponentFieldsValues},validationRules:{max:200,required:!1}},{astype:"TextField",label:"Terms",name:"Terms",value:"",placeholder:"",validationRules:{max:200,required:!1},config:{onChange:this.InvoiceComponentFieldsValues}}]}],buttons:[{type:"submit",class:"btn btn-success save",value:"Y",text:"<i class='fa fa-save pr-2'></i>Save"},{type:"button",class:"btn btn-danger",text:"<i class='fa fa-close pr-2'></i>Cancel"}],currencyId:null,currencyName:"",IsSharedCompany:!1}},async created(){await this.getClients(),await this.getTemplates(),await this.getInitialData()},methods:{setDateForm(t,e){const a=this.FormSchema[0].Data.find(t=>"Date_To"===t.name);a.config.minDate=t,this.InvoiceComponentFieldsValues()},async fieldsDetails(){const t=this.FormSchema[0].Data.find(t=>"Bill_To"===t.name);t&&(t.value=this.InvoiceFieldsDetails.bill_to,t.disabled=!0),this.isDraftMode=!0;let e=this.isDraftMode?"Invoice Number":"Bill Status";const a=this.FormSchema[0].Data.find(t=>"Invoice_Number"===t.name);a.label=e,a.value=this.InvoiceFieldsDetails.bill_number,a.disabled=!0;const s=this.FormSchema[0].Data.find(t=>"Template"===t.name);s&&(s.value=this.InvoiceFieldsDetails.template_id);const i=this.FormSchema[0].Data.find(t=>"Date_From"===t.name);i&&(i.value=this.InvoiceFieldsDetails.BillDate_From,i.disabled=!0);const l=this.FormSchema[0].Data.find(t=>"Date_To"===t.name);l&&(l.value=this.InvoiceFieldsDetails.BillDate_To,l.disabled=!0);const o=this.FormSchema[0].Data.find(t=>"Issue_Date"===t.name);o&&(o.value=this.InvoiceFieldsDetails.bill_issue_date,o.disabled=!0);const r=this.FormSchema[0].Data.find(t=>"Due_Date"===t.name);r&&(r.value=this.InvoiceFieldsDetails.bill_due_date);const n=this.FormSchema[0].Data.find(t=>"Due_Date_Comment"===t.name);n&&(n.value=this.InvoiceFieldsDetails.bill_due_date_comment,this.currencyId=this.InvoiceFieldsDetails.CurrencyId,this.Bill_To=this.InvoiceFieldsDetails.bill_to);const c=this.FormSchema[0].Data.find(t=>"Terms"===t.name);c&&(c.value=this.InvoiceFieldsDetails.Terms);this.FormSchema[0].Data.find(t=>"Project"===t.name);await this.projectListByClientId("","",t.value);let d=this.InvoiceFieldsDetails.projectIds.split(","),u=this.filteredOptions.filter(t=>d.includes(t.value));this.selectedProjects=u},toggleMode(){this.isDraftMode=!this.isDraftMode,1==this.isDraftMode&&this.getLatestInvoiceNumber(),this.FormSchema[0].Data[1].value=this.isDraftMode?"":"Draft Mode";const t=this.isDraftMode?"Invoice Number":"Bill Status";return this.FormSchema[0].Data[1].label=t},updateSelectedProjects(t,e){let[a,s,i]=e.value.split("^");this.currencyId=s,this.currencyName=i,console.log(a),console.log(s),console.log(i),this.selectedProjects=t,this.InvoiceComponentFieldsValues()},changeRecurring(t){if(1==t.target.checked){this.$emit("recurringChange",!0),this.isDraftMode=!0,1==this.isDraftMode&&this.getLatestInvoiceNumber(),this.FormSchema[0].Data[0].value="",this.FormSchema[0].Data[1].value=this.isDraftMode?"":"Draft Mode";const t=this.isDraftMode?"Invoice Number":"Bill Status";this.FormSchema[0].Data[1].label=t,this.filteredOptions=[],this.selectedProjects=[],this.isHideMessage=!0}else this.FormSchema[0].Data[0].value="",this.filteredOptions=[],this.selectedProjects=[],this.$emit("recurringChange",!1),this.isHideMessage=!1},async getClients(){const t=this;t.isLoading=!0;try{var e;const a="type=CLIENT&projectOrClientId",s=await l["a"].GetClientsAndProjects(a);if(null!==s&&void 0!==s&&null!==(e=s.data)&&void 0!==e&&e.result){const e=JSON.parse(s.data.result).data;Array.isArray(e)&&e.length>0?e.forEach(e=>{if(e.Name&&e.Id&&"string"===typeof e.Id&&""!==e.Id.trim())try{"Create"==this.Formtype?t.FormSchema[0].Data[0].config.options.push({name:e.Name,value:e.Id}):t.FormSchema[0].Data[0].config.options.push({name:e.Name,value:e.Id.split("^")[0]}),t.$refs.invoiceFields.UpdateKeyValue()}catch(a){console.error("Error processing item:",e,a)}}):console.warn("No valid data found in the response")}else console.error("Invalid response structure:",s)}catch(a){console.error("Error fetching clients:",a)}finally{t.isLoading=!1}},async projectListByClientId(t,e,a){const s=this;s.isLoading=!0,s.filteredOptions=[],s.selectedProjects=[],s.Bill_To="";try{var i;let t,o;"Create"===this.Formtype?([t,o]=e.value.split("^"),s.Bill_To=t,s.InvoiceComponentFieldsValues(),s.$emit("emailDetail",o)):t=a;const r="type=PROJECT&projectOrClientId="+t,n=await l["a"].GetClientsAndProjects(r);if(null!==n&&void 0!==n&&null!==(i=n.data)&&void 0!==i&&i.result){const t=JSON.parse(n.data.result).data;Array.isArray(t)&&t.length>0?t.forEach(t=>{if(t.Name&&t.Id&&"string"===typeof t.Id&&""!==t.Id.trim())try{if("Add"==this.Formtype){let e={label:t.Name,value:t.Id};s.filteredOptions.push(e)}else{let e={label:t.Name,value:t.Id.split("^")[0]};s.filteredOptions.push(e)}}catch(e){console.error("Error processing item:",t,e)}}):console.warn("No valid data found in the response")}else console.error("Invalid response structure:",n)}catch(o){console.error("Error fetching clients:",o)}finally{s.isLoading=!1}},async getTemplates(){const t=this;t.isLoading=!0;try{var e;const a=await l["a"].GetTemplates();if(null!==a&&void 0!==a&&null!==(e=a.data)&&void 0!==e&&e.result){const e=JSON.parse(a.data.result).data;Array.isArray(e)&&e.length>0?(e.map(e=>{t.templateList.push({name:e.TEMPLATE_NAME,value:e.TEMPLATE_ID})}),t.$refs.invoiceFields.UpdateKeyValue()):console.warn("No valid data found in the response")}else console.error("Invalid response structure:",a)}catch(a){console.error("Error fetching clients:",a)}finally{t.isLoading=!1}},handleTemplateChange(t){this.TemplateId="",this.TemplateId=t,this.InvoiceComponentFieldsValues()},async previewTemplate(){const t=this;if(t.isLoading=!0,""==this.TemplateId)return this.ShowAlert(this.$t("Please select a template"),"warning",this.$t("Alert"));try{var e;let s="templateId="+this.TemplateId;const i=await l["a"].GetPreviewTemplate(s);if(null!==i&&void 0!==i&&null!==(e=i.data)&&void 0!==e&&e.result){const e=JSON.parse(i.data.result).data;var a;if(Array.isArray(e)&&e.length>0)t.previewTemplateContent=null===(a=e[0])||void 0===a?void 0:a.template_content,t.isViewTemplate=!0;else console.warn("No valid data found in the response")}else console.error("Invalid response structure:",i)}catch(s){console.error("Error fetching templates:",s)}finally{t.isLoading=!1}},async getLatestInvoiceNumber(){const t=this;t.isLoading=!0,t.FormSchema[0].Data[1].value="";try{var e;const a=await l["a"].GetLatestInvoiceNumber();if(null!==a&&void 0!==a&&null!==(e=a.data)&&void 0!==e&&e.result){const e=a.data.result;t.FormSchema[0].Data[1].value=e}else console.error("Invalid response structure:",a)}catch(a){console.error("Error fetching InvoiceNumber:",a)}finally{t.isLoading=!1}},async getInitialData(){const t=this;t.isLoading=!0;try{const e=await l["a"].GetInitialData();if(null!=e.data){console.log("InitialData",e.data);let a=e.data.billSetting,s=e.data.companyDetail,i=e.data.sharedCompanyList;console.log("BillSetting",a),console.log("CompanyDetail",s),console.log("SharedCompanyList",i),t.IsSharedCompany=!1,i.length>0?t.IsSharedCompany=!0:t.IsSharedCompany=!1}}catch(e){console.error("Error fetching Initial Data:",e)}finally{t.isLoading=!1}},InvoiceComponentFieldsValues(){let t=this,e="Create"==t.Formtype?0:t.InvoiceFieldsDetails.bill_id,a=t.Bill_To,s=t.$refs.invoiceFields.getPropertyValue("Invoice_Number","value"),i=t.selectedProjects.map(t=>t.value.split("^")[0]).join(","),l=t.$refs.invoiceFields.getPropertyValue("Date_From","value"),o=t.$refs.invoiceFields.getPropertyValue("Date_To","value"),r=t.$refs.invoiceFields.getPropertyValue("Issue_Date","value"),n=t.$refs.invoiceFields.getPropertyValue("Due_Date","value"),c=t.$refs.invoiceFields.getPropertyValue("Template","value"),d=t.$refs.invoiceFields.getPropertyValue("Due_Date_Comment","value"),u=t.$refs.invoiceFields.getPropertyValue("Terms","value"),p=this.currencyId,m=1,v=this.IsSharedCompany,h={Bill_Id:e,Bill_To:a,Invoice_Number:s,Project:i,Date_From:l,Date_To:o,Issue_Date:r,Due_Date:n,Template:c,Due_Date_Comment:d,Terms:u,currencyId:p,PayTo:m,IsSharedCompany:v};this.$emit("InvoiceFieldsChange",h)}}},_=D,I=Object(p["a"])(_,o,r,!1,null,null,null),x=I.exports,T=function(){var t=this,e=t._self._c;return e("div",{staticClass:"row",staticStyle:{display:"flex"},attrs:{id:"ActiveOnReccuring"}},[t._m(0),e("div",{staticClass:"col-lg-3"},[e("Field",{staticClass:"w-100",attrs:{name:"Frequency",rules:{required:!1}},scopedSlots:t._u([{key:"default",fn:function({errors:a}){return[e("div",{staticClass:"form-group"},[e("label",{staticClass:"control-label",attrs:{for:"Frequency"}},[t._v("Frequency")]),t._v(": "),e("select",{directives:[{name:"model",rawName:"v-model",value:t.selectedFrequency,expression:"selectedFrequency"}],staticClass:"form-control",attrs:{name:"Frequency"},on:{change:[function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.selectedFrequency=e.target.multiple?a:a[0]},function(e){return t.handleFrequencyChange(t.selectedFrequency)}]}},[e("option",{attrs:{value:""}},[t._v(t._s(t.$t("Select")))]),t._l(t.frequencyOptions,(function(a){return e("option",{key:a.value,domProps:{value:a.value}},[t._v(" "+t._s(a.label)+" ")])}))],2)]),a[0]?e("span",{staticClass:"invalid-feedback d-block",attrs:{name:"Frequency"}},[t._v(t._s(a[0]))]):t._e()]}}])})],1),t.showCustomDateField?e("div",{staticClass:"col-lg-3",attrs:{id:"custDateDiv"}},[e("Field",{staticClass:"w-100",attrs:{name:"Custom Date",rules:{required:!1}},scopedSlots:t._u([{key:"default",fn:function({errors:a}){return[e("div",{staticClass:"form-group"},[e("label",{staticClass:"control-label",attrs:{for:"Frequency"}},[t._v("Custom Date")]),t._v(": "),e("select",{directives:[{name:"model",rawName:"v-model",value:t.selectedCustomDate,expression:"selectedCustomDate"}],staticClass:"form-control",attrs:{name:"CustomFrequencyDate"},on:{change:function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.selectedCustomDate=e.target.multiple?a:a[0]}}},t._l(t.days,(function(a){return e("option",{key:a,domProps:{value:a}},[t._v(t._s(a))])})),0),e("div",{staticClass:"pullleft cont_40_label textalignleft paddingleft7"},[e("small",[t._v("of every month")])])]),a[0]?e("span",{staticClass:"invalid-feedback d-block",attrs:{name:"Custom Date"}},[t._v(t._s(a[0]))]):t._e()]}}],null,!1,2674150201)})],1):t._e(),e("div",{staticClass:"col-lg-3"},[e("div",{staticClass:"form-group"},[e("Field",{attrs:{name:"Invoice Number",rules:{required:!1}},scopedSlots:t._u([{key:"default",fn:function({errors:a}){return[e("div",{staticClass:"d-flex"},[e("label",{staticClass:"control-label",attrs:{for:"Frequency"}},[t._v("Number of Recurrences:")]),e("a",{attrs:{href:"javascript:;","data-toggle":"tooltip",title:"0 - for unlimited or enter value 1 - 99"}},[e("i",{staticClass:"fa fa-question-circle-o text-popover pl-1"})])]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.numberOfRecurrance,expression:"numberOfRecurrance"}],staticClass:"txtitems form-control",class:{"is-invalid":a[0]},attrs:{type:"number",id:"recurrences",maxlength:"2"},domProps:{value:t.numberOfRecurrance},on:{input:[function(e){e.target.composing||(t.numberOfRecurrance=e.target.value)},t.validateInput],keydown:t.validateKey}})]}}])})],1)]),e("div",{staticClass:"col-lg-3"},[e("div",{staticClass:"form-group"},[e("label",[t._v("Delivery:")]),e("div",[e("div",{staticClass:"custom-control custom-checkbox custom-control-inline"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.selectedAutoInvoice,expression:"selectedAutoInvoice"}],staticClass:"custom-control-input",attrs:{id:"chk_2",name:"chkDelivery",type:"checkbox",value:""},domProps:{checked:Array.isArray(t.selectedAutoInvoice)?t._i(t.selectedAutoInvoice,"")>-1:t.selectedAutoInvoice},on:{change:function(e){var a=t.selectedAutoInvoice,s=e.target,i=!!s.checked;if(Array.isArray(a)){var l="",o=t._i(a,l);s.checked?o<0&&(t.selectedAutoInvoice=a.concat([l])):o>-1&&(t.selectedAutoInvoice=a.slice(0,o).concat(a.slice(o+1)))}else t.selectedAutoInvoice=i}}}),e("label",{staticClass:"custom-control-label universal-custom-control-label pt-1",attrs:{for:"chk_2"}}),t._v(" Automatically Send Invoice ")])])])]),t.UpdateEmailsArray>0?e("div",{staticClass:"col-lg-12",attrs:{id:"divRecipients"}},[e("label",[t._v(" Recipients: ")]),e("div",{staticClass:"form-group",attrs:{id:"toRecipients"}},[e("Form",{ref:"emailRecipient",staticClass:"row",scopedSlots:t._u([{key:"default",fn:function({valid:a,errors:s}){return t._l(t.emails,(function(a,s){return e("div",{key:a.id,staticClass:"col-lg-3"},[e("Field",{attrs:{rules:{required:!0},name:"email"},scopedSlots:t._u([{key:"default",fn:function({field:i,errors:l}){return[e("div",{staticClass:"input-group mb-3"},[e("input",{directives:[{name:"model",rawName:"v-model",value:a.email,expression:"entry.email"}],class:{"form-control ":!0,"is-invalid":l.length||a.errorMessage,"bg-white":0==s},attrs:{type:"email",readonly:0==s,placeholder:"Enter email"},domProps:{value:a.email},on:{input:[function(e){e.target.composing||t.$set(a,"email",e.target.value)},function(e){return t.checkDuplicateEmail(a.email,s)}],change:t.RecurringFieldsValues}}),e("span",{staticClass:"pl-2",attrs:{id:"basic-addon2"}},[t.UpdateEmailsArray==s+1?e("a",{staticClass:"round-icon-small btn-info-light",attrs:{title:" Add More",href:"javascript:;","data-toggle":"tooltip","data-original-title":"Add More"},on:{click:function(e){return t.addNewRecipient(a,s)}}},[e("i",{staticClass:"fa fa-plus"})]):t._e(),s>0?e("a",{staticClass:"delete round-icon-small btn-danger-light",attrs:{href:"javascript:;",idfor:"ancDeleRecp"},on:{click:function(e){return t.deleteRecipient(s)}}},[e("i",{staticClass:"fa fa-trash"})]):t._e()]),a.errorMessage?e("span",{staticClass:"invalid-feedback d-block"},[t._v(" "+t._s(a.errorMessage)+" ")]):t._e(),l.length?e("span",{staticClass:"invalid-feedback d-block"},[t._v(t._s(l[0]))]):t._e()])]}}],null,!0)})],1)}))}}],null,!1,3723612374)})],1)]):t._e()])},w=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"col-lg-12"},[e("div",{staticClass:"heading-border mb-3 mt-3"},[e("h5",{staticClass:"h5"},[e("span",{staticClass:"d-md-inline-block"},[t._v(" Reccuring ")])])])])}],F={computed:{showCustomDateField(){return this.RecurringFieldsValues(),this.isShowCustomData},UpdateEmailsArray(){return this.RecurringFieldsValues(),this.validateEmails(),this.emails?this.emails.length:0}},props:{emailDetail:{type:Object},recurringItemsDetails:{type:Object},Formtype:{type:String}},watch:{emailDetail(t,e){this.emails=[],this.emails.push(t)}},created(){"Create"!=this.Formtype&&this.recurringEditDetails()},data(){return{isShowCustomData:!1,selectedFrequency:"",frequencyOptions:[{value:"week",label:"Weekly"},{value:"biweek",label:"Bi-Weekly"},{value:"month",label:"Monthly"},{value:"quarterly",label:"Quarterly"},{value:"halfyear",label:"Half yearly"},{value:"annual",label:"Annually"},{value:"custom",label:"Custom Date"}],selectedCustomDate:"1",selectedAutoInvoice:!1,numberOfRecurrance:"",days:Array.from({length:31},(t,e)=>e+1),emails:[],nextId:2,duplicateEmailError:""}},methods:{recurringEditDetails(){this.selectedFrequency=this.recurringItemsDetails.selectedFrequency,this.selectedCustomDate=this.recurringItemsDetails.selectedCustomDate,this.numberOfRecurrance=this.recurringItemsDetails.numberOfRecurrance,this.selectedAutoInvoice=this.recurringItemsDetails.selectedAutoInvoice,this.handleFrequencyChange(this.selectedFrequency),this.emails=this.recurringItemsDetails.emails},handleFrequencyChange(t){return this.isShowCustomData="custom"==t},validateInput(){this.numberOfRecurrance=this.numberOfRecurrance.replace(/\D/g,""),this.numberOfRecurrance.length>2&&(this.numberOfRecurrance=this.numberOfRecurrance.slice(0,2))},validateKey(t){const e=["+","-","=","e"],a=["Backspace","Delete","ArrowLeft","ArrowRight","Tab","Enter"];e.includes(t.key)&&t.preventDefault(),t.key>="0"&&t.key<="9"||a.includes(t.key)||t.preventDefault()},toggleTip(){$('[data-toggle="tooltip"]').tooltip({trigger:"click"}).on("shown.bs.tooltip",(function(){var t=$(this);setTimeout((function(){t.tooltip("hide")}),2e3)}))},checkDuplicateEmail(t,e){this.emails.forEach((t,e)=>{this.$set(this.emails,e,{...t,errorMessage:""})});const a=this.emails.some((a,s)=>a.email===t&&s!==e);return!!a&&(this.$set(this.emails,e,{...this.emails[e],errorMessage:"This email is already in the list."}),!0)},validateEmails(){let t=!1;return this.emails.forEach((e,a)=>{this.checkDuplicateEmail(e.email,a)&&(t=!0)}),t},addNewRecipient(){let t=!1;t=this.validateEmails(),1!=t?this.$refs.emailRecipient.validate().then(t=>{t?this.emails.push({id:this.emails.length+1,email:"",errorMessage:""}):console.log("Validation failed")}).catch(t=>{console.error("Validation error: ",t)}):this.$refs.emailRecipient.validate()},replaceWithInput(t){const e=prompt("Enter new email:",this.emails[t].email);e&&this.validateEmail(e)&&this.$set(this.emails,t,{...this.emails[t],email:e})},validateEmail(t){const e=/^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/;return e.test(t)},deleteRecipient(t){this.emails.splice(t,1),this.validateEmails()},RecurringFieldsValues(){let t=this,e=t.selectedFrequency,a=t.selectedCustomDate,s=t.numberOfRecurrance,i=t.selectedAutoInvoice,l=t.emails.map(t=>t.email).join(","),o={selectedFrequency:e,selectedCustomDate:a,numberOfRecurrance:s,selectedAutoInvoice:i,emails:l};this.$emit("RecurringFieldsChange",o),console.log(o)}}},k=F,A=(a("53aa"),Object(p["a"])(k,T,w,!1,null,"3cd72f2d",null)),S=A.exports,R=function(){var t=this,e=t._self._c;return e("div",[t._m(0),e("div",{staticClass:"row form_row",attrs:{id:"inventor"}},[e("div",{staticClass:"col-lg-12"},[e("div",{staticClass:"table-responsive mb-3"},[e("Form",{ref:"invoiceItemsFields",scopedSlots:t._u([{key:"default",fn:function({valid:a,errors:s}){return[e("table",{staticClass:"invoiceitem table table-bordered dt-responsive nowrap mb-0",attrs:{id:"tblInvoiceItem"}},[e("thead",{staticClass:"thead-bg"},[e("tr",[e("th",{staticClass:"td2 tdcm",attrs:{width:"18%"}},[t._v(t._s(t.$t("ItemName")))]),e("th",{staticClass:"td3",attrs:{width:"40%"}},[t._v(t._s(t.$t("DESCRIPTION")))]),e("th",{staticClass:"td4 tdcm",attrs:{width:"20%",align:"center"}},[t._v(t._s(t.$t("RateXUnits")))]),e("th",{staticClass:"td5",attrs:{width:"10%"}},[t._v(" "+t._s(t.$t("Price"))),e("label",{attrs:{for:"lblPriceCurrency"}},[t._v(t._s(t.GetUserInfo.Currency))])]),e("th",{staticClass:"td1 tdcm text-center",attrs:{width:"10%"}},[t._v(t._s(t.$t("Action")))]),e("th",{attrs:{width:"6%"}},[t._v("Â ")])])]),e("tbody",t._l(t.updateInvoiceItems,(function(a,s){return e("tr",{key:s},[e("td",[e("Field",{attrs:{name:"Item Name",rules:{required:!0}},scopedSlots:t._u([{key:"default",fn:function({errors:s}){return[e("div",{staticClass:"input-group"},[e("input",{directives:[{name:"model",rawName:"v-model",value:a.name,expression:"item.name"}],class:{"txtitems form-control ":!0,"is-invalid":s[0]},attrs:{type:"text",id:"",placeholder:"Enter Item name"},domProps:{value:a.name},on:{input:function(e){e.target.composing||t.$set(a,"name",e.target.value)}}})]),s.length?e("span",{staticClass:"invalid-feedback d-block"},[t._v(t._s(s[0]))]):t._e()]}}],null,!0)})],1),e("td",[e("Field",{attrs:{name:"Description",rules:{required:!1}},scopedSlots:t._u([{key:"default",fn:function({errors:s}){return[e("div",{staticClass:"input-group"},[e("input",{directives:[{name:"model",rawName:"v-model",value:a.description,expression:"item.description"}],class:{"txtitems form-control ":!0,"is-invalid":s[0]},attrs:{type:"text",id:"",placeholder:"Enter Item Description"},domProps:{value:a.description},on:{input:function(e){e.target.composing||t.$set(a,"description",e.target.value)}}})]),s.length?e("span",{staticClass:"invalid-feedback d-block"},[t._v(t._s(s[0]))]):t._e()]}}],null,!0)})],1),e("td",{staticClass:"td4 tdcm"},[e("div",{staticClass:"d-flex"},[e("Field",{attrs:{name:"Rate",rules:{required:!0}},scopedSlots:t._u([{key:"default",fn:function({errors:s}){return[e("div",{staticClass:"input-group"},[e("input",{directives:[{name:"model",rawName:"v-model",value:a.rate,expression:"item.rate"}],class:{"txtitems form-control ":!0,"is-invalid":s[0]},attrs:{type:"number",id:"Rate",placeholder:"Enter a rate"},domProps:{value:a.rate},on:{keydown:t.validateKey,keyup:function(e){return t.calculatePrice(a,"rate")},input:function(e){e.target.composing||t.$set(a,"rate",e.target.value)}}})]),s.length?e("span",{staticClass:"invalid-feedback d-block"},[t._v(t._s(s[0]))]):t._e()]}}],null,!0)}),e("div",{staticClass:"input-group-apend"},[e("span",{staticClass:"input-group-text border-0 bg-transparent"},[t._v(" x")])]),e("Field",{attrs:{name:"Units",rules:{required:!0}},scopedSlots:t._u([{key:"default",fn:function({errors:s}){return[e("div",{staticClass:"input-group"},[e("input",{directives:[{name:"model",rawName:"v-model",value:a.units,expression:"item.units"}],class:{"txtitems form-control ":!0,"is-invalid":s[0]},attrs:{type:"number",id:"Units",placeholder:"Enter a unit"},domProps:{value:a.units},on:{keydown:t.validateKey,keyup:function(e){return t.calculatePrice(a,"unit")},input:function(e){e.target.composing||t.$set(a,"units",e.target.value)}}})]),s.length?e("span",{staticClass:"invalid-feedback d-block"},[t._v(t._s(s[0]))]):t._e()]}}],null,!0)})],1)]),e("td",{staticClass:"td5 tdcm"},[e("Field",{attrs:{name:"Price",rules:{required:!1}},scopedSlots:t._u([{key:"default",fn:function({errors:s}){return[e("div",{staticClass:"input-group"},[e("input",{directives:[{name:"model",rawName:"v-model",value:a.price,expression:"item.price"}],class:{"txtitems form-control ":!0,"is-invalid":s[0]},attrs:{type:"number",id:"Price",disabled:!0},domProps:{value:a.price},on:{input:function(e){e.target.composing||t.$set(a,"price",e.target.value)}}})]),s.length?e("span",{staticClass:"invalid-feedback d-block"},[t._v(t._s(s[0]))]):t._e()]}}],null,!0)})],1),e("td",{staticClass:"single-action text-center"},[t.updateInvoiceItems.length>=1?e("a",{class:{"text-danger":t.updateInvoiceItems.length>1,disabled:t.updateInvoiceItems.length<=1},on:{click:function(e){return t.removeItem(s)}}},[e("em",{staticClass:"fa fa-trash"})]):t._e()])])})),0),e("tfoot",[e("tr",{staticClass:"ui-state-default"},[e("td"),e("td"),e("td",{staticClass:"td4 arialb000000 text-right align-middle"},[t._v(" Sub Total "),e("label",{attrs:{for:"lblSubTotalCurrency"}},[t._v(t._s(t.GetUserInfo.Currency))]),t._v(": ")]),e("td",{staticClass:"td5 tdcm"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.subTotal,expression:"subTotal"}],staticClass:"form-control pay_field2 number bg-white",attrs:{type:"text",readonly:""},domProps:{value:t.subTotal},on:{input:function(e){e.target.composing||(t.subTotal=e.target.value)}}})]),e("td",{staticClass:"td1 tdcm"})])])])]}}])})],1)])]),e("div",{staticClass:"row"},[e("div",{staticClass:"col-lg-6"},[e("div",{staticClass:"form-group"},[e("div",{staticClass:"form_row",attrs:{id:"CommentDiv"}},[e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.billDescription,expression:"billDescription"}],staticClass:"form-control addinvoice",attrs:{maxlength:"500",placeholder:"Enter a Comment",rows:"6",id:"BillDescription",name:"BillDescription"},domProps:{value:t.billDescription},on:{input:function(e){e.target.composing||(t.billDescription=e.target.value)}}})])])]),e("div",{staticClass:"col-lg-6"},[e("div",{staticClass:"form-group text-right"},[e("div",{staticClass:"py-2 pl-3 bg-grey"},[e("a",{staticClass:"btn btn-info mr-1",attrs:{id:"addnewLine",href:"javascript:;",title:"","data-toggle-tooltip":"tooltip","data-original-title":"Add New Row"},on:{click:function(e){return t.addInvoiceItems(t.valid,t.errors)}}},[t._v(t._s(t.$t("AddNewRow")))])])]),e("Discounts",{attrs:{InvoiceItemsTotalPrice:t.subTotal,discountDetails:t.discountDetails,InvoiceFieldsDetails:t.InvoiceFieldsDetails},on:{updateDiscountTotal:t.updateDiscountTotal,DiscountItemsDetails:t.handleDiscountItemsDetails}}),e("Taxes",{attrs:{taxDetails:t.taxDetails,discountTotalAmount:t.subDiscountTotal,InvoiceFieldsDetails:t.InvoiceFieldsDetails},on:{TaxItemsDetails:t.handleTaxItemsDetails}}),t.isWorkOrder?e("WorkOrder"):t._e()],1)])])},P=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"row"},[e("div",{staticClass:"col-lg-12"},[e("div",{staticClass:"heading-border mb-3 mt-3"},[e("h5",{staticClass:"h5"},[e("span",{staticClass:"d-md-inline-block"},[t._v(" Invoice Items ")])])])])])}],O=(a("13d5"),function(){var t=this,e=t._self._c;return e("div",{staticClass:"listing"},[e("div",{staticClass:"table-responsive position-relative overflow-visible"},[e("Form",{ref:"discountsItemsFields",scopedSlots:t._u([{key:"default",fn:function({valid:a,errors:s}){return[e("table",{staticClass:"table table-bordered",attrs:{id:"billAdjustment"}},[e("thead",{staticClass:"thead-bg"},[e("tr",{attrs:{role:"row"}},[e("th",{attrs:{colspan:"3"}},[e("label",{staticClass:"pr-3"},[t._v(t._s(t.$t("Discounts"))+":")]),e("div",{staticClass:"custom-control custom-radio custom-control-inline"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.discountType,expression:"discountType"}],staticClass:"custom-control-input",attrs:{type:"radio","data-resource":"Is Sequential",value:"Sequential",id:"rdo_1"},domProps:{checked:t._q(t.discountType,"Sequential")},on:{change:[function(e){t.discountType="Sequential"},function(e){return t.handleDiscountTypeChange(e,"Sequential")}]}}),e("label",{staticClass:"custom-control-label",attrs:{for:"rdo_1"}},[t._v(t._s(t.$t("IsSequential")))])]),e("div",{staticClass:"custom-control custom-radio custom-control-inline"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.discountType,expression:"discountType"}],staticClass:"custom-control-input",attrs:{type:"radio","data-resource":"Is Stacked",value:"Stack",id:"rdo_2"},domProps:{checked:t._q(t.discountType,"Stack")},on:{change:[function(e){t.discountType="Stack"},function(e){return t.handleDiscountTypeChange(e,"Stack")}]}}),e("label",{staticClass:"custom-control-label",attrs:{for:"rdo_2"}},[t._v(t._s(t.$t("IsStacked")))])])]),e("th",{staticClass:"td3 tdrrm_nd_bold",staticStyle:{width:"120px"}},[e("a",{staticClass:"btn btn-primary float-right adinvc",attrs:{href:"javascript:;",id:"ancDiscount",title:"","data-toggle-tooltip":"tooltip","data-original-title":"Add More"},on:{click:function(e){return t.addDiscountRow(a,s)}}},[e("i",{staticClass:"fa fa-plus pr-2",attrs:{"aria-hidden":"true"}}),t._v(t._s(t.$t("Add"))+" ")])])])]),e("tbody",t._l(t.discountAddUpadate,(function(a,s){return e("tr",{key:s,staticClass:"ui-state-default"},[e("td",{attrs:{width:"48%"}},[e("Field",{attrs:{name:"Discount name",rules:{required:!0}},scopedSlots:t._u([{key:"default",fn:function({errors:s}){return[e("div",{staticClass:"input-group"},[e("input",{directives:[{name:"model",rawName:"v-model",value:a.label,expression:"discount.label"}],class:{"txtitems form-control ":!0,"is-invalid":s[0]},attrs:{type:"text",id:"label",maxlength:"50",placeholder:"Enter discount name"},domProps:{value:a.label},on:{input:function(e){e.target.composing||t.$set(a,"label",e.target.value)}}})])]}}],null,!0)})],1),e("td",{attrs:{width:"20%"}},[e("Field",{attrs:{name:"Percentage",rules:{required:!0}},scopedSlots:t._u([{key:"default",fn:function({errors:i}){return[e("div",{staticClass:"input-group"},[e("input",{directives:[{name:"model",rawName:"v-model",value:a.percentage,expression:"discount.percentage"}],class:{"txtitems form-control ":!0,"is-invalid":i[0]},attrs:{type:"decimal",id:"label",placeholder:"Enter percentage",maxlength:"5"},domProps:{value:a.percentage},on:{keydown:function(e){return t.validateKey(e)},input:[function(e){e.target.composing||t.$set(a,"percentage",e.target.value)},function(e){return t.validatePercentage(s)}]}}),e("div",{staticClass:"input-group-append discpercentage"},[e("span",{staticClass:"input-group-text"},[t._v("%")])])])]}}],null,!0)})],1),e("td",{attrs:{width:"20%"}},[e("Field",{attrs:{name:"Total",rules:{required:!1}},scopedSlots:t._u([{key:"default",fn:function({errors:s}){return[e("div",{staticClass:"input-group"},[e("input",{directives:[{name:"model",rawName:"v-model",value:a.total,expression:"discount.total"}],staticClass:"price_paddright3 form-control invoicebox2_nd",attrs:{type:"decimal",readonly:"",autocomplete:"off"},domProps:{value:a.total},on:{input:function(e){e.target.composing||t.$set(a,"total",e.target.value)}}})])]}}],null,!0)})],1),e("td",{staticClass:"td4 single-action text-center",attrs:{width:"8%"}},[e("a",{staticClass:"addDiscount text-danger",attrs:{href:"javascript:;",title:"","data-toggle-tooltip":"tooltip","data-original-title":"Delete"},on:{click:function(e){return t.removeDiscountRow(s)}}},[e("em",{staticClass:"fa fa-trash"})])])])})),0),e("tfoot",[e("tr",{staticClass:"ui-state-default"},[e("td"),e("td",{staticClass:"td4 arialb000000 text-right align-middle"},[t._v(" "+t._s(t.$t("TotalDiscount"))),e("label",{attrs:{for:"lblSubTotalCurrency"}},[t._v(t._s(t.GetUserInfo.Currency))]),t._v(": ")]),e("td",{staticClass:"td5 tdcm"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.discountTotal,expression:"discountTotal"}],staticClass:"form-control pay_field2 number bg-white",attrs:{type:"text",readonly:""},domProps:{value:t.discountTotal},on:{input:function(e){e.target.composing||(t.discountTotal=e.target.value)}}})]),e("td",{staticClass:"td1 tdcm"})]),e("tr",{staticClass:"ui-state-default"},[e("td"),e("td",{staticClass:"td4 arialb000000 text-right align-middle"},[t._v(" Sub total after discount "),e("label",{attrs:{for:"lblSubTotalCurrency"}},[t._v(" "+t._s(t.GetUserInfo.Currency))]),t._v(": ")]),e("td",{staticClass:"td5 tdcm"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.discountTotalAmount,expression:"discountTotalAmount"}],staticClass:"form-control pay_field2 number bg-white",attrs:{type:"text",readonly:""},domProps:{value:t.discountTotalAmount},on:{input:function(e){e.target.composing||(t.discountTotalAmount=e.target.value)}}})]),e("td",{staticClass:"td1 tdcm"})])])])]}}])})],1)])}),N=[],M={computed:{discountAddUpadate(){return this.DiscountItemsDetails(),this.discounts},discountTotal(){return this.totalDiscount.toFixed(2)},discountTotalAmount(){const t=this.totalAmount();return this.$emit("updateDiscountTotal",t),t}},props:{InvoiceItemsTotalPrice:{type:Number},discountDetails:{type:Array},InvoiceFieldsDetails:{type:Object}},watch:{InvoiceItemsTotalPrice(t,e){this.originalPrice=t,this.InvoiceTotalPrice=t,this.calInvoiceTotalPrice=t,this.handleDiscountType(),this.applyDiscounts()},discountDetails(t,e){this.discounts=t},InvoiceFieldsDetails(t,e){1==t.DiscountType?this.handleDiscountTypeChange("","Stack"):this.handleDiscountTypeChange("","Sequential")}},data(){return{discountType:"Sequential",discounts:[{label:"",percentage:"",total:""}],originalPrice:0,InvoiceTotalPrice:0,totalDiscount:0,calInvoiceTotalPrice:0}},created(){},methods:{totalAmount(){if("Sequential"===this.discountType)return this.InvoiceTotalPrice.toFixed(2);if("Stack"===this.discountType){let t=this.originalPrice-this.totalDiscount;return t.toFixed(2)}},handleDiscountType(){"Sequential"===this.discountType?(this.totalDiscount=0,this.InvoiceTotalPrice=this.calInvoiceTotalPrice):"Stack"===this.discountType&&(this.totalDiscount=0,this.InvoiceTotalPrice=0)},applyDiscounts(){this.discounts.forEach((t,e)=>{this.validatePercentage(e)})},validateKey(t){const e=["+","-","=","e"],a=["Backspace","Delete","ArrowLeft","ArrowRight","Tab","Enter","."];e.includes(t.key)&&t.preventDefault(),t.key>="0"&&t.key<="9"||a.includes(t.key)||t.preventDefault()},addDiscountRow(t,e){let a=!1;this.discounts.forEach(t=>{""==t.label&&""==t.percentage&&(a=!0,this.$refs.discountsItemsFields.validate())}),0==a?this.$refs.discountsItemsFields.validate().then(t=>{t?this.discounts.push({label:"",percentage:"",total:""}):this.ShowAlert(this.$t("Please correct the highlighted errors"),"failure",this.$t("Alert"))}).catch(t=>{console.error("Validation error: ",t)}):this.ShowAlert(this.$t("Please correct the highlighted errors"),"failure",this.$t("Alert"))},handleDiscountTypeChange(t,e){this.discountType=e,this.handleDiscountType(),this.applyDiscounts()},async removeDiscountRow(t){try{const e=await new Promise(t=>{this.confirmR(this.$t("Are you sure you want to delete these record(s)?"),!0,!1,t)});void 0==e&&(this.discounts.splice(t,1),this.handleDiscountType(),this.applyDiscounts(),this.ShowAlert(this.$t("Item has been deleted Successfully "),"success",this.$t("Alert")))}catch(e){console.error("Error during confirmation:",e)}},validatePercentage(t){const e=this.discounts[t];let a=parseFloat(e.percentage);if(isNaN(a))return 0;"Sequential"===this.discountType?e.total=this.calculateSequentialDiscounts(t,a):"Stack"===this.discountType&&(e.total=this.calculateStackedDiscounts(t,a))},calculateSequentialDiscounts(t){let e=this.InvoiceTotalPrice,a=this.totalDiscount,s=e*(this.discounts[t].percentage/100);for(let i=0;i<=t;i++)if(i==t){let t=e*(this.discounts[i].percentage/100);a+=t,e-=t}return this.InvoiceTotalPrice=e,this.totalDiscount=a,s.toFixed(2)},calculateStackedDiscounts(t,e){let a=0,s=0;for(let i=0;i<=t;i++)s+=this.originalPrice*(this.discounts[i].percentage/100);return this.totalDiscount=s,a=this.originalPrice*(this.discounts[t].percentage/100),a},DiscountItemsDetails(){let t=this,e=t.discounts,a=t.discountTotal,s=t.discountTotalAmount,i=t.discountType,l={discounts:e,discountTotal:a,discountTotalAmount:s,discountType:i};this.$emit("DiscountItemsDetails",l)}}},E=M,q=(a("7f52"),Object(p["a"])(E,O,N,!1,null,"62ee21ae",null)),L=q.exports,j=function(){var t=this,e=t._self._c;return e("div",{staticClass:"listing mt-3"},[e("div",{staticClass:"table-responsive"},[e("Form",{ref:"TaxItemsFields",scopedSlots:t._u([{key:"default",fn:function({valid:a,errors:s}){return[e("table",{staticClass:"table table-bordered",attrs:{id:"taxAdjustments"}},[e("thead",{staticClass:"thead-bg"},[e("tr",[e("th",{staticClass:"td0",attrs:{colspan:"3",width:"80%"}},[t._v(t._s(t.$t("Taxes"))+":")]),e("th",{staticClass:"td3 tdrrm_nd_bold",staticStyle:{width:"120px"}},[e("a",{staticClass:"btn btn-primary float-right addDiscount",attrs:{href:"javascript:;",title:"Add More"},on:{click:t.addTaxRow}},[e("em",{staticClass:"fa fa-plus pr-2",attrs:{"aria-hidden":"true"}}),t._v(t._s(t.$t("Add"))+" ")])])])]),e("tbody",t._l(t.taxes,(function(a,s){return e("tr",{key:a.id,staticClass:"ui-state-default"},[e("td",{staticClass:"td1",attrs:{width:"48%"}},[e("Field",{attrs:{name:"Tax name",rules:{required:!0}},scopedSlots:t._u([{key:"default",fn:function({errors:i}){return[e("div",[e("input",{directives:[{name:"model",rawName:"v-model",value:a.label,expression:"tax.label"}],class:{"txtitems form-control":!0,"is-invalid":i[0]},attrs:{type:"text",id:"label",maxlength:"50",placeholder:"Enter tax name"},domProps:{value:a.label},on:{input:[function(e){e.target.composing||t.$set(a,"label",e.target.value)},function(e){return t.searchTaxCategories(a)}]}}),t.showDropdown&&t.filteredTaxList.length?e("ul",{staticClass:"dropdown-list"},t._l(t.filteredTaxList,(function(i,l){return e("li",{key:l,on:{click:function(e){return t.selectTax(a,i,s)}}},[t._v(" "+t._s(i.name)+" ")])})),0):t._e()])]}}],null,!0)})],1),e("td",{staticClass:"td2 tdcm",attrs:{width:"20%"}},[e("Field",{attrs:{name:"Tax percentage",rules:{required:!0}},scopedSlots:t._u([{key:"default",fn:function({errors:i}){return[e("div",{staticClass:"input-group"},[e("input",{directives:[{name:"model",rawName:"v-model",value:a.percentage,expression:"tax.percentage"}],class:{"txtitems form-control":!0,"is-invalid":i[0]},attrs:{type:"text",id:"label",maxlength:"50",placeholder:"Enter percentage"},domProps:{value:a.percentage},on:{keydown:function(e){return t.validateKey(e)},input:[function(e){e.target.composing||t.$set(a,"percentage",e.target.value)},function(e){return t.calculateTax(s)}]}}),e("div",{staticClass:"input-group-append discpercentage"},[e("span",{staticClass:"input-group-text",domProps:{textContent:t._s(a.rate_type&&"P"===a.rate_type.toUpperCase()?"%":"Flat")}})])])]}}],null,!0)})],1),e("td",{staticClass:"td3",attrs:{width:"20%"}},[e("Field",{attrs:{name:"Total",rules:{required:!1}},scopedSlots:t._u([{key:"default",fn:function({errors:s}){return[e("div",{staticClass:"input-group"},[e("input",{directives:[{name:"model",rawName:"v-model",value:a.total,expression:"tax.total"}],staticClass:"price_paddright3 form-control invoicebox2_nd",attrs:{type:"decimal",readonly:"",autocomplete:"off"},domProps:{value:a.total},on:{input:function(e){e.target.composing||t.$set(a,"total",e.target.value)}}})])]}}],null,!0)})],1),e("td",{staticClass:"td4 single-action text-center",attrs:{width:"8%"}},[e("a",{staticClass:"addDiscount text-danger",attrs:{href:"javascript:;"},on:{click:function(e){return t.removeTaxRow(s)}}},[e("em",{staticClass:"fa fa-trash"})])])])})),0),e("tfoot",[e("tr",{staticClass:"ui-state-default"},[e("td"),e("td",{staticClass:"td4 arialb000000 text-right align-middle"},[t._v(" "+t._s(t.$t("Total"))+" "+t._s(t.$t("Tax"))+" "),e("label",{attrs:{for:"lblSubTotalCurrency"}},[t._v(t._s(t.GetUserInfo.Currency))]),t._v(": ")]),e("td",{staticClass:"td5 tdcm"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.totalTax,expression:"totalTax"}],staticClass:"form-control pay_field2 number bg-white",attrs:{type:"text",readonly:""},domProps:{value:t.totalTax},on:{input:function(e){e.target.composing||(t.totalTax=e.target.value)}}})]),e("td",{staticClass:"td1 tdcm"})]),e("tr",{staticClass:"ui-state-default"},[e("td"),e("td",{staticClass:"td4 arialb000000 text-right align-middle"},[t._v(" "+t._s(t.$t("Total"))+" "+t._s(t.$t("After"))+" "+t._s(t.$t("Tax"))+" "),e("label",{attrs:{for:"lblSubTotalCurrency"}},[t._v(t._s(t.GetUserInfo.Currency))]),t._v(": ")]),e("td",{staticClass:"td5 tdcm"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.totalTaxAmount,expression:"totalTaxAmount"}],staticClass:"form-control pay_field2 number bg-white",attrs:{type:"text",readonly:""},domProps:{value:t.totalTaxAmount},on:{input:function(e){e.target.composing||(t.totalTaxAmount=e.target.value)}}})]),e("td",{staticClass:"td1 tdcm"})]),e("tr",{staticClass:"title5 title_topbod"},[e("td",{staticClass:"td2 tdcm tdrrm_nd text-right",attrs:{colspan:"2"}},[e("strong",[t._v(" "+t._s(t.$t("DiscountFlatRate"))+" "),e("label",{attrs:{for:"lblDiscountFlatRateCurrency"}},[t._v(t._s(t.GetUserInfo.Currency))]),t._v(":")])]),e("td",{staticClass:"td3"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.discountFlatRate,expression:"discountFlatRate"}],staticClass:"form-control invoicebox2_nd",attrs:{type:"text"},domProps:{value:t.discountFlatRate},on:{keydown:function(e){return t.validateKey(e)},input:[function(e){e.target.composing||(t.discountFlatRate=e.target.value)},t.calculatedTotal]}})]),e("td")]),e("tr",{staticClass:"title5 title_topbod"},[e("td",{staticClass:"td2 tdcm tdrrm_nd text-right",attrs:{colspan:"2"}},[e("strong",[t._v(t._s(t.$t("AdvanceReceived"))),e("label",{attrs:{for:"lblAdvanceReceivedCurrency"}},[t._v(t._s(t.GetUserInfo.Currency))]),t._v(":")])]),e("td",{staticClass:"td3"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.advanceReceived,expression:"advanceReceived"}],staticClass:"form-control invoicebox2_nd",attrs:{type:"text"},domProps:{value:t.advanceReceived},on:{keydown:function(e){return t.validateKey(e)},input:[function(e){e.target.composing||(t.advanceReceived=e.target.value)},t.calculatedTotal]}})]),e("td")]),e("tr",{staticClass:"title5 title_topbod"},[e("td",{staticClass:"td2 tdcm tdrrm_nd text-right arial16b000000",attrs:{colspan:"2"}},[e("strong",[t._v(" "+t._s(t.$t("N etTotal"))),e("label",{attrs:{for:"lblNetTotalCurrency"}},[t._v(t._s(t.GetUserInfo.Currency))]),t._v(":")])]),e("td",{staticClass:"td3"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.calculatedTotal,expression:"calculatedTotal"}],staticClass:"form-control pay_field2 number",attrs:{type:"text",readonly:""},domProps:{value:t.calculatedTotal},on:{input:function(e){e.target.composing||(t.calculatedTotal=e.target.value)}}})]),e("td")])])])]}}])})],1)])},V=[],B={props:{discountTotalAmount:{type:Number},taxDetails:{type:Array},InvoiceFieldsDetails:{type:Object}},watch:{discountTotalAmount(t,e){this.totalAmount=t,this.calTotalAmount=t,this.applyTaxes()},taxDetails(t,e){this.taxes=t},InvoiceFieldsDetails(t,e){this.discountFlatRate=t.DiscountFlatRate,this.advanceReceived=t.BillAdvanceAmount}},computed:{taxAddUpdate(){return this.TaxItemsDetails(),this.taxes},totalTax(){return this.taxes.reduce((t,e)=>t+(parseFloat(e.total)||0),0).toFixed(2)},totalTaxAmount(){const t=parseFloat(this.totalAmount)||0;return(t+parseFloat(this.totalTax)).toFixed(2)},calculatedTotal(){const t=parseFloat(this.totalTaxAmount)||0,e=parseFloat(this.discountFlatRate)||0,a=parseFloat(this.advanceReceived)||0;let s=t-e-a;return isNaN(s)&&(s=0),s.toFixed(2)}},data(){return{filteredTaxList:[],showDropdown:!1,TaxCategoryList:[],taxes:[{label:"",percentage:"",total:"",rate_type:""}],discountFlatRate:0,advanceReceived:0,netTotal:0,totalAmount:0,calTotalAmount:0}},created(){},methods:{GetTaxCategory(t=""){var e=this,a=`id=&moduleName=&type=TAX_CATEGORY&search=${t}&refId=`;l["a"].GetDDLData(a).then(a=>{200===a.status&&a.data.DATA&&(e.TaxCategoryList=a.data.DATA.map(t=>({value:t.value,name:t.name,first_value:t.first_value||0,second_value:t.second_value||0})),e.filteredTaxList=e.TaxCategoryList.filter(e=>e.name.toLowerCase().includes(t.toLowerCase())),e.showDropdown=!0)})},searchTaxCategories(t){const e=(null===t||void 0===t?void 0:t.label)||"";e.length>1?this.GetTaxCategory(e):(this.showDropdown=!1,t.percentage=0,t.rate_type="")},selectTax(t,e,a){const s=this.taxes.some(t=>t.label===e.name);s?this.showDropdown=!1:(t.label=e.name,this.showDropdown=!1,this.TaxCategoryData=e.value,t.percentage=0,t.rate_type="",this.TaxCategoryDetails(t,a))},TaxCategoryDetails(t,e){var a=this;a.isLoading=!0;var s=`TaxCategoryId=${a.TaxCategoryData}&Type=Tax_Category`;l["a"].GetTaxCategoryDetails(s).then((function(s){if(a.isLoading=!1,0===s.data.result.SLABDATA.length?t.RateData=[{AmountFrom:0,AmountTo:0,TaxRate:0}]:t.RateData=s.data.result.SLABDATA,s.data.result.DATA.length>0){var i=s.data.result.DATA[0];t.rate_type=i.rate_type&&["P","F"].includes(i.rate_type.toUpperCase())?i.rate_type.toUpperCase():"F";const l=a.calTotalAmount,o=t.RateData.find(t=>l>=t.AmountFrom&&(0===t.AmountTo||l<=t.AmountTo));o&&(t.percentage=o.TaxRate,a.calculateTax(e))}})).catch((function(t){console.error("Error fetching Tax Category details: ",t)}))},validateKey(t){const e=["+","-","=","e"],a=["Backspace","Delete","ArrowLeft","ArrowRight","Tab","Enter","."];e.includes(t.key)&&t.preventDefault(),t.key>="0"&&t.key<="9"||a.includes(t.key)||t.preventDefault()},applyTaxes(){this.taxes.forEach((t,e)=>{this.calculateTax(e)})},addTaxRow(t,e){let a=!1;this.taxes.forEach(t=>{""==t.label&&""==t.percentage&&(a=!0,this.$refs.TaxItemsFields.validate())}),0==a?this.$refs.TaxItemsFields.validate().then(t=>{t?this.taxes.push({label:"",percentage:0,total:"",rate_type:""}):this.ShowAlert(this.$t("Please correct the highlighted errors"),"failure",this.$t("Alert"))}).catch(t=>{console.error("Validation error: ",t)}):this.ShowAlert(this.$t("Please correct the highlighted errors"),"failure",this.$t("Alert"))},async removeTaxRow(t){try{const e=await new Promise(t=>{this.confirmR(this.$t("Are you sure you want to delete these record(s)?"),!0,!1,t)});void 0==e&&(this.taxes.splice(t,1),this.applyTaxes(),this.ShowAlert(this.$t("Item has been deleted Successfully "),"success",this.$t("Alert")))}catch(e){console.error("Error during confirmation:",e)}},calculateTax(t){const e=this.taxes[t],a=e.baseAmount||this.calTotalAmount;if(a){if(a&&e.RateData&&e.RateData.length>0){const t=e.RateData.find(t=>a>=t.AmountFrom&&(0===t.AmountTo||a<=t.AmountTo));t&&(e.percentage=t.TaxRate)}e.rate_type&&"P"===e.rate_type.toUpperCase()?e.total=a*parseFloat(e.percentage||0)/100:e.rate_type&&"F"===e.rate_type.toUpperCase()?e.total=parseFloat(e.percentage||0):e.total=0}else e.total=0},TaxItemsDetails(){let t=this,e=t.taxes,a=t.totalTax,s=t.totalTaxAmount,i=this.calculatedTotal,l=t.discountFlatRate,o=t.advanceReceived,r={taxes:e,totalTax:a,totalTaxAmount:s,netTotal:i,discountFlatRate:l,advanceReceived:o};this.$emit("TaxItemsDetails",r)}}},U=B,W=(a("2323"),Object(p["a"])(U,j,V,!1,null,"44a44901",null)),G=W.exports,Y=function(){var t=this,e=t._self._c;return e("div",[e("section",[e("div",{staticClass:"my-popups"},[e("loader",{attrs:{"is-visible":t.isLoading}}),e("div",{staticClass:"modal d-block"},[e("div",{staticClass:"modal-dialog modal-dialog-centered"},[e("div",{staticClass:"modal-content"},[e("div",{staticClass:"modal-header theme-primary partition-full d-flex"},[e("h5",{staticClass:"modal-title"},[t._v(t._s(t.$t("WorkOrder")))]),e("button",{staticClass:"close",attrs:{type:"button"},on:{click:t.closeWorkOrder}},[e("em",{staticClass:"fa fa-times",attrs:{"aria-hidden":"true"}})])]),t._m(0),e("div",{staticClass:"modal-footer",staticStyle:{"flex-wrap":"inherit"}},[e("button",{staticClass:"btn btn-danger",attrs:{type:"button"},on:{click:t.closeWorkOrder}},[e("i",{staticClass:"fa fa-times"}),t._v(" Close")])])])])])],1)])])},K=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"modal-body"},[e("div",{staticClass:"modal-body",staticStyle:{height:"auto","min-height":"0px","max-height":"none"},attrs:{id:"divAddWorkOrder"}},[e("div",{staticClass:"row"},[e("div",{staticClass:"col-lg-4"},[e("div",{staticClass:"form-group"},[e("label",[t._v("Search by")]),e("select",{staticClass:"form-control",attrs:{id:"ddlBillability",name:"Billability"}},[e("option",{attrs:{value:"0"}},[t._v("Ticket Number")]),e("option",{attrs:{value:"1"}},[t._v("WO Number")]),e("option",{attrs:{value:"2"}},[t._v("Date Range")])])])]),e("div",{staticClass:"col-lg-5",attrs:{id:"divTicketNumberOrWorkOrder"}},[e("div",{staticClass:"form-group"},[e("label",[t._v("Value")]),e("input",{staticClass:"form-control input-validation-error",attrs:{id:"txt_ValuesForWorkOrderSearch",type:"text"}})])]),e("div",{staticClass:"col-lg-5",staticStyle:{display:"none"},attrs:{id:"divDateRange"}},[e("label",[t._v("Date Range")]),e("div",{staticClass:"row"},[e("div",{staticClass:"col-lg-6"},[e("div",{staticClass:"form-group"},[e("div",{staticClass:"input-group"},[e("input",{staticClass:"form-control",attrs:{id:"txt_WorkOrderFrom",type:"text",placeholder:"From"}})])])]),e("div",{staticClass:"col-lg-6"},[e("div",{staticClass:"form-group"},[e("div",{staticClass:"input-group"},[e("input",{staticClass:"form-control",attrs:{id:"txt_WorkOrderTo",type:"text",placeholder:"To"}})])])])])]),e("div",{staticClass:"col-lg-2"},[e("div",{staticClass:"form-group"},[e("label",{staticStyle:{width:"100%"}},[t._v("Â ")]),e("input",{staticClass:"btn btn-info",attrs:{id:"btnGetWorkOrder",type:"button",title:"Get Work Order",value:"Get Work Order",name:""}})])])]),e("div",{staticClass:"row"},[e("div",{staticClass:"col-lg-12"},[e("div",{staticClass:"table-responsive mb-3"},[e("table",{staticClass:"table table-bordered mb-0",attrs:{id:"tableWorkOrder"}},[e("thead",{staticClass:"thead-bg"},[e("tr",[e("th",[t._v("WO Number")]),e("th",[t._v("Subject")]),e("th",[t._v("Status")])])]),e("tbody",[e("tr",[e("td",{staticClass:"no-record",staticStyle:{color:"red","text-align":"center"},attrs:{colspan:"4"}},[t._v("No record(s) found")])])])])])])]),e("div",{staticClass:"row"},[e("div",{staticClass:"col-lg-12"},[e("div",{staticClass:"form-group text-right"},[e("input",{staticClass:"btn btn-success",attrs:{id:"btnAddWorkOrder",type:"button",title:"Add Work Order",value:"Add Work Order",name:""}})])])])])])}],J={data(){return{}},methods:{closeWorkOrder(){this.$parent.isWorkOrder=!1}}},Q=J,z=Object(p["a"])(Q,Y,K,!1,null,null,null),H=z.exports,Z={components:{Discounts:L,Taxes:G,WorkOrder:H},computed:{subTotal(){return this.invoiceItems.reduce((t,e)=>t+(parseFloat(e.price)||0),0)},updateInvoiceItems(){return this.InvoiceItemsDetails(),this.invoiceItems}},props:{invoiceItemDetails:{type:Array},InvoiceFieldsDetails:{type:Object},discountDetails:{type:Array},taxDetails:{type:Array}},watch:{invoiceItemDetails(t,e){this.invoiceItems=t},InvoiceFieldsDetails(t,e){this.billDescription=t.bill_description}},data(){return{invoiceItems:[{name:"",description:"",rate:"",units:"",price:0}],billDescription:"",subDiscountTotal:0,isWorkOrder:!1}},created(){},methods:{updateDiscountTotal(t){this.subDiscountTotal=parseInt(t)},addInvoiceItems(t,e){let a=!1;this.invoiceItems.forEach(t=>{""==t.name&&""==t.rate&&""==t.units&&(a=!0,this.$refs.invoiceItemsFields.validate())}),0==a?this.$refs.invoiceItemsFields.validate().then(t=>{t?this.invoiceItems.push({name:"",description:"",rate:"",units:"",price:0}):this.ShowAlert(this.$t("Please correct the highlighted errors"),"failure",this.$t("Alert"))}).catch(t=>{console.error("Validation error: ",t)}):this.ShowAlert(this.$t("Please correct the highlighted errors"),"failure",this.$t("Alert"))},async removeItem(t){try{const e=await new Promise(t=>{this.confirmR(this.$t("Are you sure you want to delete these record(s)?"),!0,!1,t)});void 0==e&&(this.invoiceItems.splice(t,1),this.$refs.invoiceItemsFields.$reset(),this.ShowAlert(this.$t("Item has been deleted Successfully "),"success",this.$t("Alert")))}catch(e){console.error("Error during confirmation:",e)}},calculatePrice(t,e){"rate"!==e&&"unit"!==e||(t.price=(parseFloat(t.rate)||0)*(parseFloat(t.units)||0))},validateKey(t){const e=["+","-","=","e"],a=["Backspace","Delete","ArrowLeft","ArrowRight","Tab","Enter","."];e.includes(t.key)&&t.preventDefault(),t.key>="0"&&t.key<="9"||a.includes(t.key)||t.preventDefault()},InvoiceItemsDetails(){let t=this,e=t.invoiceItems,a=t.subTotal,s=this.billDescription,i={invoiceItems:e,subTotal:a,billDescription:s};this.$emit("InvoiceItemsDetails",i)},handleDiscountItemsDetails(t){this.$emit("DiscountItemsDetails",t)},handleTaxItemsDetails(t){this.$emit("TaxItemsDetails",t)},addWorkOrder(){this.isWorkOrder=!0}}},X=Z,tt=(a("c97e"),Object(p["a"])(X,R,P,!1,null,"17c1b886",null)),et=tt.exports,at={components:{InvoiceFields:x,Reccuring:S,InvoiceItems:et},computed:{Reccuring(){return this.isRecurring}},data(){return{isRecurring:!1,emailDetail:{},invoiceDetails:{},recurringDetails:{},invoiceItemsDetails:{},discountItemsDetails:{},taxItemsDetails:{},isLoading:!1,InvoiceFieldsDetails:{},invoiceItemDetails:[],discountDetails:[],taxDetails:[],Formtype:"",recurringItemsDetails:{}}},async created(){let t=this.$route.params.id;this.Formtype=this.$route.params.action,"0"!=t&&await this.getEditInvoiceDetails(t)},methods:{selectedEmailDetail(t){this.emailDetail={},this.emailDetail={id:0,email:t,errorMessage:""}},handleRecurring(t){this.isRecurring=t},async saveInvoiceDetails(t,e){try{const t=await this.$refs.AddInvoice.validate();if(t){this.isLoading=!0;let t={invoiceDetails:this.invoiceDetails,recurringDetails:this.recurringDetails,invoiceItemsDetails:this.invoiceItemsDetails,discountItemsDetails:this.discountItemsDetails,taxItemsDetails:this.taxItemsDetails};console.log("Invoice",JSON.stringify(t));const e=`postString=${JSON.stringify(t)}&formType=${"Create"==this.Formtype?"Save":"Update"}`,a=await l["a"].SaveAndUpdateManualInvoice(e);"3"==a.data.result.StatusCode?(this.isLoading=!1,this.ShowAlert(this.$t("Duplicate invoice number"),"Error",this.$t("Alert")),console.log("Invoice save failed due to duplicate number!")):"1"==a.data.result.StatusCode?(this.isLoading=!1,this.ShowAlert(this.$t("Invoice saved successfully"),"Success",this.$t("Alert")),this.$router.push("/ClientBill/Index"),console.log("Invoice saved successfully!")):"2"==a.data.result.StatusCode?(this.isLoading=!1,this.ShowAlert(this.$t("Invoice updated successfully"),"Success",this.$t("Alert")),this.$router.push("/ClientBill/Index"),console.log("Invoice updated successfully!")):"-1"==a.data.result.StatusCode&&(this.isLoading=!1,this.ShowAlert(this.$t(a.data.result.StatusMessage),"failure",!0,this.$t("Alert")))}else this.ShowAlert(this.$t("Please correct the highlighted errors"),"failure",this.$t("Alert"))}catch(a){console.log("Error message:",a)}},handleInvoiceFieldsChange(t){this.invoiceDetails={},t.isRecurring=this.Reccuring,this.invoiceDetails={...t},console.log("Received invoice fields details:",this.invoiceDetails)},handleRecurringFieldsChange(t){this.recurringDetails={},this.recurringDetails=t,console.log("Received recurring fields details:",t)},handleInvoiceItemsDetails(t){this.invoiceItemsDetails={},this.invoiceItemsDetails=t,console.log("Received invoice items details:",t)},handleDiscountItems(t){this.discountItemsDetails={},this.discountItemsDetails=t,console.log("Received discount items:",t)},handleTaxItems(t){this.taxItemsDetails={},this.taxItemsDetails=t,console.log("Received tax items:",t)},async getEditInvoiceDetails(t){const e=this;e.isLoading=!0;try{var a,s;const i="billId="+t,o=await l["a"].GetEditInvoiceDetails(i);if(null===o||void 0===o||null===(a=o.data)||void 0===a||!a.result)return void console.error("Invalid response structure:",o);const r=null===(s=JSON.parse(o.data.result))||void 0===s?void 0:s.data;if(!Array.isArray(r)||0===r.length)return e.discountDetails=[],e.taxDetails=[],void(e.invoiceItemDetails=[]);const{InvoiceItems:n,discountsAndtaxes:c}=r[0];if(e.discountDetails=[],e.taxDetails=[],e.InvoiceFieldsDetails=r[0],1===e.InvoiceFieldsDetails.is_recurring){e.isRecurring=!0;const t=e.InvoiceFieldsDetails.to_recipients.split(",");this.recurringItemsDetails={selectedFrequency:e.InvoiceFieldsDetails.recurring_frequency,selectedCustomDate:e.InvoiceFieldsDetails.custom_frequency_date,numberOfRecurrance:e.InvoiceFieldsDetails.no_of_reoccurence,selectedAutoInvoice:e.InvoiceFieldsDetails.SendRecurringAutomatically,emails:t.map((t,e)=>({id:e+1,email:t,errorMessage:""}))},console.log("recurringItemsDetails",this.recurringItemsDetails)}else e.isRecurring=!1;e.invoiceItemDetails=n.map(t=>({name:t.item_name,description:t.item_description,rate:t.item_unitPrice,units:t.item_Qty,price:t.total})),null===c||void 0===c||c.forEach(t=>{const a={label:t.AdjName,percentage:t.AdjPercentage,total:t.AdjAmount};"discounts"===t.AdjOperator?e.discountDetails.push(a):"Taxes"===t.AdjOperator&&e.taxDetails.push(a)})}catch(i){console.error("Error fetching invoice details:",i)}finally{e.isLoading=!1}}}},st=at,it=(a("79e5"),Object(p["a"])(st,s,i,!1,null,null,null));e["default"]=it.exports},"141c":function(t,e,a){var s=a("4bad");e=s(!1),e.push([t.i,"input[type=number][data-v-17c1b886]::-webkit-inner-spin-button,input[type=number][data-v-17c1b886]::-webkit-outer-spin-button{-webkit-appearance:none;margin:0}input[type=number][data-v-17c1b886]{-moz-appearance:textfield}",""]),t.exports=e},"17de":function(t,e,a){"use strict";a("c6cb")},"1bba":function(t,e,a){var s=a("4bad");e=s(!1),e.push([t.i,"table tr td[data-v-3cb7b2c0]{border-bottom:none!important}",""]),t.exports=e},"204a":function(t,e,a){var s=a("433a");s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);var i=a("499e").default;i("65c11087",s,!0,{sourceMap:!1,shadowMode:!1})},2323:function(t,e,a){"use strict";a("71fb")},"30e8":function(t,e,a){var s=a("4bad");e=s(!1),e.push([t.i,"input[type=number][data-v-44a44901]::-webkit-inner-spin-button,input[type=number][data-v-44a44901]::-webkit-outer-spin-button{-webkit-appearance:none;margin:0}input[type=number][data-v-44a44901]{-moz-appearance:textfield}",""]),t.exports=e},"433a":function(t,e,a){var s=a("4bad");e=s(!1),e.push([t.i,".heading-border .custom-control.custom-checkbox{display:inline}",""]),t.exports=e},"53aa":function(t,e,a){"use strict";a("be22")},7157:function(t,e,a){var s=a("e2d2");s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);var i=a("499e").default;i("b243f828",s,!0,{sourceMap:!1,shadowMode:!1})},"71fb":function(t,e,a){var s=a("30e8");s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);var i=a("499e").default;i("3c8c4f86",s,!0,{sourceMap:!1,shadowMode:!1})},"79e5":function(t,e,a){"use strict";a("204a")},"7f52":function(t,e,a){"use strict";a("7157")},"87f6":function(t,e,a){var s=a("9daf");s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);var i=a("499e").default;i("440c4822",s,!0,{sourceMap:!1,shadowMode:!1})},"9daf":function(t,e,a){var s=a("4bad");e=s(!1),e.push([t.i,".loader{border:4px solid #f3f3f3;border-top:4px solid #3498db;border-radius:50%;width:40px;height:40px;animation:spin 1s linear infinite}@keyframes spin{0%{transform:rotate(0deg)}to{transform:rotate(1turn)}}",""]),t.exports=e},be22:function(t,e,a){var s=a("eb10");s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);var i=a("499e").default;i("f1eff294",s,!0,{sourceMap:!1,shadowMode:!1})},c6cb:function(t,e,a){var s=a("1bba");s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);var i=a("499e").default;i("a00fc3e2",s,!0,{sourceMap:!1,shadowMode:!1})},c97e:function(t,e,a){"use strict";a("db3c")},db3c:function(t,e,a){var s=a("141c");s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);var i=a("499e").default;i("4760d4ba",s,!0,{sourceMap:!1,shadowMode:!1})},e2d2:function(t,e,a){var s=a("4bad");e=s(!1),e.push([t.i,"input[type=number][data-v-62ee21ae]::-webkit-inner-spin-button,input[type=number][data-v-62ee21ae]::-webkit-outer-spin-button{-webkit-appearance:none;margin:0}input[type=number][data-v-62ee21ae]{-moz-appearance:textfield}",""]),t.exports=e},e89e:function(t,e,a){"use strict";a("87f6")},eb10:function(t,e,a){var s=a("4bad");e=s(!1),e.push([t.i,"input[type=number][data-v-3cd72f2d]::-webkit-inner-spin-button,input[type=number][data-v-3cd72f2d]::-webkit-outer-spin-button{-webkit-appearance:none;margin:0}input[type=number][data-v-3cd72f2d]{-moz-appearance:textfield}",""]),t.exports=e}}]);
//# sourceMappingURL=chunk-ac55f698.js.map