(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-28b708b3"],{"0b57":function(t,a,e){"use strict";e("9fcf")},"9d34":function(t,a,e){"use strict";e.r(a);var s=function(){var t=this,a=t._self._c;return a("section",[a("loader",{attrs:{"is-visible":t.isLoading}}),t.templatedata.length?a("div",{staticClass:"container-fluid invoice-payment p-0"},[a("div",{staticClass:"col-sm-12 col-md-12 float-left col-lg-12 col-xl-12 bg-lightgrey py-4"},[a("div",{staticClass:"row"},[a("div",{staticClass:"col-sm-12 col-md-12 float-left col-lg-6 col-xl-6",attrs:{id:"title"}},[a("div",{staticClass:"form-group"},[a("label",[t._v(t._s(t.$t("YouareWorkingWith"))+":")]),a("input",{staticClass:"form-control",attrs:{type:"text"},domProps:{value:t.templatedata[0].companyname}})])]),a("div",{staticClass:"col-sm-12 col-md-12 float-left col-lg-6 col-xl-6",attrs:{id:"title"}},[a("div",{staticClass:"form-group"},[a("label",[t._v(t._s(t.$t("ChooseAnotherCompany"))+":")]),a("select",{directives:[{name:"model",rawName:"v-model",value:t.selectedCompanyId,expression:"selectedCompanyId"}],staticClass:"form-control",on:{change:function(a){var e=Array.prototype.filter.call(a.target.options,(function(t){return t.selected})).map((function(t){var a="_value"in t?t._value:t.value;return a}));t.selectedCompanyId=a.target.multiple?e:e[0]}}},[a("option",{attrs:{disabled:"",value:""}},[t._v(t._s(t.$t("SelectCompany")))]),t._l(t.companies,(function(e){return a("option",{key:e.value,domProps:{value:e.value}},[t._v(" "+t._s(e.name)+" ")])}))],2)])])])]),a("div",{staticClass:"theme-primary partition"},[a("span",{staticClass:"p-name text-white"},[t._v(t._s(t.$t("BillPayment")))]),a("span",{staticClass:"p-actions float-right"},[a("a",{staticClass:"p-action-btn text-white",attrs:{title:"Back to List",href:"javascript:;"},on:{click:t.goToInvoiceListing}},[a("em",{staticClass:"fa fa-angle-double-left"}),a("br"),a("span",[t._v(" "+t._s(t.$t("BacktoList")))])])])]),a("div",{staticClass:"col-sm-12 col-md-12 float-left col-lg-12 col-xl-12 border mb-4 py-3"},[a("div",{staticClass:"card probx"},[a("div",{staticClass:"card-header"},[a("h2",{staticClass:"mb-0"},[t._v(t._s(t.$t("BillDetail")))])]),a("div",{staticClass:"card-body"},[a("div",{staticClass:"form-row"},[a("div",{staticClass:"col-sm-12 col-md-6 col-lg-4 col-xl-4"},[a("div",{staticClass:"form-group"},[a("label",[a("strong",[t._v(t._s(t.$t("BillNumber"))+":")]),t._v(" "+t._s(t.templatedata[0].invoicenumber))])])]),a("div",{staticClass:"col-sm-12 col-md-6 col-lg-4 col-xl-4"},[a("div",{staticClass:"form-group"},[a("label",[a("strong",[t._v(t._s(t.$t("DueDate"))+":")]),t._v(" "+t._s(t.templatedata[0].duedate))])])]),a("div",{staticClass:"col-sm-12 col-md-6 col-lg-4 col-xl-4"},[a("div",{staticClass:"form-group"},[a("label",[a("strong",[t._v(t._s(t.$t("TotalAmount"))+" ("+t._s(t.templatedata[0].isocode||"-")+"):")]),t._v(" "+t._s(null!=t.templatedata[0].totalamountyouowe?t.templatedata[0].totalamountyouowe:"-"))])])]),a("div",{staticClass:"col-sm-12 col-md-6 col-lg-4 col-xl-4"},[a("div",{staticClass:"form-group"},[a("label",[a("strong",[t._v(t._s(t.$t("Paid Amount"))+":")]),t._v(" "+t._s(t.$n(t.PaymentAmount,"currency",t.$getLocaleByCurrency(t.CurrencyCode))))])])]),a("div",{staticClass:"col-sm-12 col-md-6 col-lg-4 col-xl-4"},[a("div",{staticClass:"form-group"},[a("label",[a("strong",[t._v(t._s(t.$t("RemainingAmountDue"))+":")]),t._v(" "+t._s(t.$n(t.TotalDueAmount,"currency",t.$getLocaleByCurrency(t.CurrencyCode))))])])])])])]),a("div",{staticClass:"card probx mt-4"},[a("div",{staticClass:"card-header"},[a("h2",{staticClass:"mb-0"},[t._v(t._s(t.$t("From")))])]),a("div",{staticClass:"card-body"},[a("div",{staticClass:"form-row"},[a("div",{staticClass:"col-sm-12 col-md-6 col-lg-4 col-xl-4"},[a("div",{staticClass:"form-group"},[a("label",[a("strong",[t._v(t._s(t.$t("CompanyName"))+":")]),t._v(" "+t._s(t.templatedata[0].companyname))])])]),a("div",{staticClass:"col-sm-12 col-md-6 col-lg-4 col-xl-4"},[a("div",{staticClass:"form-group"},[a("label",[a("strong",[t._v(t._s(t.$t("Address"))+":")]),t._v(" "+t._s(t.templatedata[0].companyaddress))])])]),a("div",{staticClass:"col-sm-12 col-md-6 col-lg-4 col-xl-4"},[a("div",{staticClass:"form-group"},[a("label",[a("strong",[t._v(t._s(t.$t("EmailId"))+":")]),t._v(" "+t._s(t.templatedata[0].email_id))])])]),a("div",{staticClass:"col-sm-12 col-md-6 col-lg-4 col-xl-4"},[a("div",{staticClass:"form-group"},[a("label",[a("strong",[t._v(t._s(t.$t("ProjectName"))+":")]),t._v(" "+t._s(t.templatedata[0].project_name))])])]),a("div",{staticClass:"col-sm-12 col-md-6 col-lg-4 col-xl-4"},[a("div",{staticClass:"form-group"},[a("label",[a("strong",[t._v(t._s(t.$t("Phone"))+":")]),t._v(" "+t._s(t.templatedata[0].contact_mobile_phone))])])])])])]),a("div",{staticClass:"card probx mt-4"},[a("div",{staticClass:"card-header"},[a("h2",{staticClass:"mb-0"},[t._v(t._s(t.$t("Payment")))])]),a("div",{staticClass:"card-body"},[a("div",{staticClass:"mb-3",attrs:{id:"ProcessPayment"}},[a("div",{staticClass:"form-group"},[a("label",{staticClass:"font-weight-bold"},[t._v(t._s(t.$t("PaymentMethod"))+":")])]),t.noGateways?a("div",{staticClass:"alert alert-danger text-center"},[t._v(" "+t._s(t.$t("NoPaymentGatewayDefined")||"No Payment gateway defined!")+" ")]):a("div",{staticClass:"clientwalletsprite"},[t._l(t.paymentGateways,(function(e,s){return a("div",{key:s,staticClass:"col-sm-12 col-lg-12 col-md-12 mb-0 p-0"},[a("button",{staticClass:"btn w-100 py-3",class:[e.PaymantGatewayType,"",{active:t.selectedGateway===e.PaymentGatewayCode}],attrs:{type:"button"},on:{click:function(a){return t.selectGateway(e.PaymentGatewayCode)}}},[a("em",{class:t.selectedGateway===e.PaymentGatewayCode?"fa fa-check-circle float-left font-20 text-success":"fa fa-circle-thin float-left font-20"})])])})),t.PaymentLink?a("div",{staticClass:"col-md-4 mb-3"},[a("a",{staticClass:"btn btn-outline-info w-100 py-3",attrs:{href:t.PaymentLink,target:"_blank"}},[t._v(" "+t._s(t.$t("ExternalLink")||"External Link")+" ")])]):t._e()],2),a("input",{attrs:{type:"hidden",name:"PaymentGatewayCode"},domProps:{value:t.selectedGateway}})]),a("div",{staticClass:"right-forms"},["Wallet"!==t.selectedGateway&&"PayU"!==t.selectedGateway&&"Razorpay"!==t.selectedGateway&&"Stripe"!==t.selectedGateway?a("div",{staticClass:"row mb-3 py-3"},[a("div",{staticClass:"col-sm-12 col-md-6 col-lg-4 col-xl-4"},[a("div",{staticClass:"form-group"},[a("label",[t._v(t._s(t.$t("CardType"))+":"),a("span",{staticClass:"text-danger"},[t._v("*")])]),a("select",{directives:[{name:"model",rawName:"v-model",value:t.card.cardType,expression:"card.cardType"}],staticClass:"form-control",class:{"is-invalid":t.cardErrors.cardType},on:{change:[function(a){var e=Array.prototype.filter.call(a.target.options,(function(t){return t.selected})).map((function(t){var a="_value"in t?t._value:t.value;return a}));t.$set(t.card,"cardType",a.target.multiple?e:e[0])},function(a){t.cardErrors.cardType=""}]}},[a("option",{attrs:{value:"Visa"}},[t._v("Visa")]),a("option",{attrs:{value:"Master"}},[t._v("Master Card")]),a("option",{attrs:{value:"Discover"}},[t._v("Discover")]),a("option",{attrs:{value:"Amex"}},[t._v("American Express")])]),t.cardErrors.cardType?a("small",{staticClass:"text-danger"},[t._v(t._s(t.cardErrors.cardType))]):t._e()])]),a("div",{staticClass:"col-sm-12 col-md-6 col-lg-4 col-xl-4"},[a("div",{staticClass:"form-group"},[a("label",[t._v(t._s(t.$t("CardNumber"))+":"),a("span",{staticClass:"text-danger"},[t._v("*")])]),a("input",{directives:[{name:"model",rawName:"v-model",value:t.card.number,expression:"card.number"}],staticClass:"form-control",class:{"is-invalid":t.cardErrors.number},attrs:{type:"text"},domProps:{value:t.card.number},on:{input:[function(a){a.target.composing||t.$set(t.card,"number",a.target.value)},function(a){t.cardErrors.number=""}]}}),t.cardErrors.number?a("small",{staticClass:"text-danger"},[t._v(t._s(t.cardErrors.number))]):t._e()])]),a("div",{staticClass:"col-sm-12 col-md-6 col-lg-4 col-xl-4"},[a("div",{staticClass:"form-group"},[a("label",[t._v(t._s(t.$t("NameOnCard"))+":"),a("span",{staticClass:"text-danger"},[t._v("*")])]),a("input",{directives:[{name:"model",rawName:"v-model",value:t.card.name,expression:"card.name"}],staticClass:"form-control",class:{"is-invalid":t.cardErrors.name},attrs:{type:"text"},domProps:{value:t.card.name},on:{input:[function(a){a.target.composing||t.$set(t.card,"name",a.target.value)},function(a){t.cardErrors.name=""}]}}),t.cardErrors.name?a("small",{staticClass:"text-danger"},[t._v(t._s(t.cardErrors.name))]):t._e()])]),a("div",{staticClass:"col-sm-12 col-md-6 col-lg-4 col-xl-4"},[a("div",{staticClass:"form-group"},[a("label",[t._v(t._s(t.$t("ExpirationDate"))+":"),a("span",{staticClass:"text-danger"},[t._v("*")])]),a("div",{staticClass:"row no-gutters"},[a("div",{staticClass:"col-6 pr-1"},[a("select",{directives:[{name:"model",rawName:"v-model",value:t.card.expMonth,expression:"card.expMonth"}],staticClass:"form-control",class:{"is-invalid":t.cardErrors.expMonth},on:{change:[function(a){var e=Array.prototype.filter.call(a.target.options,(function(t){return t.selected})).map((function(t){var a="_value"in t?t._value:t.value;return a}));t.$set(t.card,"expMonth",a.target.multiple?e:e[0])},function(a){t.cardErrors.expMonth=""}]}},[a("option",{attrs:{disabled:"",value:""}},[t._v("Month")]),t._l(t.months,(function(e,s){return a("option",{key:s,domProps:{value:(s+1).toString().padStart(2,"0")}},[t._v(" "+t._s(e)+" ")])}))],2),t.cardErrors.expMonth?a("small",{staticClass:"text-danger"},[t._v(t._s(t.cardErrors.expMonth))]):t._e()]),a("div",{staticClass:"col-6 pl-1"},[a("select",{directives:[{name:"model",rawName:"v-model",value:t.card.expYear,expression:"card.expYear"}],staticClass:"form-control",class:{"is-invalid":t.cardErrors.expYear},on:{change:[function(a){var e=Array.prototype.filter.call(a.target.options,(function(t){return t.selected})).map((function(t){var a="_value"in t?t._value:t.value;return a}));t.$set(t.card,"expYear",a.target.multiple?e:e[0])},function(a){t.cardErrors.expYear=""}]}},[a("option",{attrs:{disabled:"",value:""}},[t._v("Year")]),t._l(t.years,(function(e){return a("option",{key:e},[t._v(t._s(e))])}))],2),t.cardErrors.expYear?a("small",{staticClass:"text-danger"},[t._v(t._s(t.cardErrors.expYear))]):t._e()])])])])]):t._e(),a("div",{directives:[{name:"show",rawName:"v-show",value:"Stripe"==t.selectedGateway,expression:"selectedGateway == 'Stripe' "}]},[a("form",{ref:"paymentForm",on:{submit:function(a){return a.preventDefault(),t.submitPayment.apply(null,arguments)}}},[a("div",{staticClass:"row py-3"},[a("div",{staticClass:"col-sm-12 col-md-6 col-lg-4 col-xl-4"},[a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"cardholder-name"}},[t._v("Name On Card:")]),a("input",{directives:[{name:"model",rawName:"v-model",value:t.billingDetails.name,expression:"billingDetails.name"}],staticClass:"stripe-input w-100 form-control",attrs:{type:"text",placeholder:"Name On Card"},domProps:{value:t.billingDetails.name},on:{input:function(a){a.target.composing||t.$set(t.billingDetails,"name",a.target.value)}}})])]),t._m(0),t._m(1),t._m(2),a("div",{staticClass:"text-danger",attrs:{id:"card-errors"}},[t._v(" "+t._s(t.errorMessage))])]),a("div",{staticClass:"col-12 mt-3 p-0"},[a("div",{staticClass:"row flex-row-reverse"},[a("div",{staticClass:"col-lg-6 text-right"},[a("input",{ref:"stripeToken",attrs:{type:"hidden"}}),a("input",{ref:"hdnCardType",attrs:{type:"hidden"}}),a("input",{ref:"hdnNameonCard",attrs:{type:"hidden"}}),a("input",{ref:"hdnCardNumber",attrs:{type:"hidden"}}),a("input",{ref:"hdnCardMonth",attrs:{type:"hidden"}}),a("input",{ref:"hdnCardYear",attrs:{type:"hidden"}}),a("input",{ref:"hdnCvv",attrs:{type:"hidden"}})])])])])]),["Stripe","Wallet","Authorize","PayU","Razorpay"].includes(t.selectedGateway)?a("div",{staticClass:"row mb-3 py-3"},["Wallet"===t.selectedGateway?a("div",{staticClass:"col-sm-12 col-md-6 col-lg-4 col-xl-4"},[a("div",{staticClass:"form-group"},[a("label",[t._v(t._s(t.$t("Available Balance"))+" ("+t._s(t.templatedata[0].isocode)+"):")]),a("input",{staticClass:"form-control",attrs:{type:"text",disabled:""},domProps:{value:t.walletBalance}})])]):t._e(),a("div",{staticClass:"col-sm-12 col-md-6 col-lg-4 col-xl-4"},[a("div",{staticClass:"form-group"},[a("label",[t._v(t._s(t.$t("RemainingAmountDue"))+" ("+t._s(t.templatedata[0].isocode)+"):")]),a("input",{staticClass:"form-control",attrs:{type:"text",disabled:""},domProps:{value:t.TotalDueAmount}})])]),a("div",{staticClass:"col-sm-12 col-md-6 col-lg-4 col-xl-4"},[a("div",{staticClass:"form-group"},[a("label",{staticClass:"d-block mb-2"},[t._v(t._s(t.$t("PaymentType"))+":")]),a("div",{staticClass:"d-flex align-items-center"},[a("div",{staticClass:"form-check mr-3"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.paymentType,expression:"paymentType"}],staticClass:"form-check-input",attrs:{type:"radio",id:"full",value:"f"},domProps:{checked:t._q(t.paymentType,"f")},on:{change:function(a){t.paymentType="f"}}}),a("label",{staticClass:"form-check-label",attrs:{for:"full"}},[t._v(" "+t._s(t.$t("FullBalance"))+" ")])]),a("div",{staticClass:"form-check"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.paymentType,expression:"paymentType"}],staticClass:"form-check-input",attrs:{type:"radio",id:"partial",value:"p"},domProps:{checked:t._q(t.paymentType,"p")},on:{change:function(a){t.paymentType="p"}}}),a("label",{staticClass:"form-check-label",attrs:{for:"partial"}},[t._v(" "+t._s(t.$t("PartialPaid"))+" ")])])])])]),"p"===t.paymentType?a("div",{staticClass:"col-sm-12 col-md-6 col-lg-4 col-xl-4"},[a("div",{staticClass:"form-group"},[a("label",[t._v("Enter Amount ("+t._s(t.templatedata[0].isocode)+"):")]),a("input",{directives:[{name:"model",rawName:"v-model",value:t.paymentAmount,expression:"paymentAmount"}],staticClass:"form-control",class:{"is-invalid":t.errorMessage},attrs:{type:"text"},domProps:{value:t.paymentAmount},on:{input:[function(a){a.target.composing||(t.paymentAmount=a.target.value)},t.validateAmount]}}),t.errorMessage?a("small",{staticClass:"text-danger"},[t._v(t._s(t.errorMessage))]):t._e()])]):t._e()]):t._e(),a("div",{staticClass:"col-12 p-0"},[a("div",{staticClass:"row flex-row-reverse"},[a("div",{staticClass:"col-lg-6 text-right d-flex justify-content-end"},[a("a",{staticClass:"btn btn-info",staticStyle:{"margin-right":"10px"},attrs:{href:"javascript:;"},on:{click:t.payNow}},[a("em",{staticClass:"fa fa-credit-card-alt pr-2"}),t._v(t._s(t.$t("PayNow"))+" ")]),a("a",{staticClass:"btn btn-danger",attrs:{href:"javascript:;"},on:{click:t.cancelPayment}},[a("em",{staticClass:"fa fa-times pr-2"}),t._v("Cancel ")])]),a("div",{staticClass:"col-lg-6 text-danger"},[a("small",[t._v(t._s(t.$t("MandatoryString")))])])])])])])])])]):t._e()],1)},r=[function(){var t=this,a=t._self._c;return a("div",{staticClass:"col-sm-12 col-md-6 col-lg-4 col-xl-4"},[a("div",{staticClass:"form-group"},[a("label",[t._v("Card Number: "),a("span",{staticClass:"mandatory"},[t._v("*")])]),a("div",{staticClass:"stripe-input form-control",attrs:{id:"card-number-element"}})])])},function(){var t=this,a=t._self._c;return a("div",{staticClass:"col-sm-12 col-md-6 col-lg-4 col-xl-4"},[a("div",{staticClass:"form-group"},[a("label",[t._v("Expiry Date: "),a("span",{staticClass:"mandatory"},[t._v("*")])]),a("div",{staticClass:"stripe-input form-control",attrs:{id:"card-expiry-element"}})])])},function(){var t=this,a=t._self._c;return a("div",{staticClass:"col-sm-12 col-md-6 col-lg-4 col-xl-4"},[a("div",{staticClass:"form-group"},[a("label",[t._v("CVC: "),a("span",{staticClass:"mandatory"},[t._v("*")])]),a("div",{staticClass:"stripe-input form-control",attrs:{id:"card-cvc-element"}})])])}],i=(e("14d9"),e("9769")),l={data(){return{walletBalance:0,paymentAmount:"",errorMessage:"",IsUtilityBilling:!1,paymentHistoryData:[],paymentList:[],MainInvocieNetAmount:0,totalPayments:0,templatedata:[],companies:[],selectedCompanyId:"",paymentGateways:[],selectedGateway:"",PaymentLink:"",paymentType:"f",finalAmount:0,card:{cardType:"Visa",number:"",name:"",expMonth:"",expYear:""},years:[],months:["January","February","March","April","May","June","July","August","September","October","November","December"],UserId:"",BillIdEnc:"",BillId:"",cardErrors:{cardType:"",number:"",name:"",expMonth:"",expYear:""},isLoading:!1,PaymentAmount:0,TotalDueAmount:0,TransactionId:null,UniqueId:null,ClientEmail:null,createdDone:null,stripe:null,elements:null,cardNumber:null,cardExpiry:null,cardCvc:null,billingDetails:{name:""},stripePublishableKey:"pk_test_51RjfwB4C6gUvp1ei45F8RMBEUh9vCrFMZgb6Qgrs78Rs9ED9gX2H0HpVm0Pv7NlHiGOc7wdJ1OtH7phwoxpJMgMY00tzECaTbs"}},computed:{noGateways(){return(!this.paymentGateways||0===this.paymentGateways.length)&&!this.PaymentLink}},watch:{async selectedGateway(t){"Stripe"===t&&(await this.loadStripeScript(),this.initializeStripe())}},async mounted(){await this.createdDone,"Stripe"===this.selectedGateway&&(await this.loadStripeScript(),this.initializeStripe())},created:async function(){this.createdDone=(async()=>{this.isLoading=!0;try{this.CurrencyCode=this.GetUserInfo.Currency.replace(/[()]/g,""),this.UserId=this.GetUserInfo.ID,this.ClientEmail=this.GetUserInfo.Email,this.BillIdEnc=this.$route.params.billId,this.BillId=this.$route.params.InvoiceId,await this.CheckExtraFeatures(),this.generateYears(),await this.GetActiveGatewayDetail(),await this.GetConfigurationValueBykey(),await this.GetInvoiceDetail(),await this.GetClientBillingDetailsAndAddress(),await this.GetCompanyListing(),await this.AddPaymentTranaction()}catch(t){console.error("Error during created lifecycle:",t)}finally{this.isLoading=!1}})()},watch:{selectedGateway(){this.errorMessage="",this.paymentAmount=""}},methods:{cancelPayment(){this.$router.push("/ClientBill/InvoiceListing")},validateAmount(){var t=this;if(!this.paymentAmount||isNaN(this.paymentAmount)||parseFloat(this.paymentAmount)<=0)this.errorMessage="Please enter a valid positive amount.";else{if(this.selectedGateway){if(parseFloat(this.paymentAmount)>t.TotalDueAmount)return void(this.errorMessage="Entered amount exceeds the remaining due amount of "+t.TotalDueAmount);this.errorMessage=""}else this.errorMessage="";"Wallet"===this.selectedGateway&&parseFloat(this.paymentAmount)>this.walletBalance?this.errorMessage="Entered amount exceeds the available wallet balance of "+this.walletBalance:this.errorMessage=""}},async CheckExtraFeatures(t){var a=this;const e="featureCode=GET_EXTRA_FEATURE_BILLING&outputType=list";try{const t=await i["a"].CheckExtraFeatures(e);if(t.data){const e=JSON.parse(t.data);e.forEach(t=>{"UTILITY_BILLING"===t.FEATURE_CODE?a.IsUtilityBilling=!0:a.IsUtilityBilling=!1})}}catch(s){console.log("Error checking extra features:",s)}},generateYears(){const t=(new Date).getFullYear();for(let a=0;a<15;a++)this.years.push(t+a)},async GetInvoiceDetail(){var t,a,e=this;e.IsUtilityBilling;const s=`billId=${this.BillIdEnc}&sourceType=${this.IsUtilityBilling}`,r=await i["a"].getInvoiceDetails(s);this.templatedata=r.data.result.data,e.finalAmount=(null===(t=e.templatedata[0])||void 0===t?void 0:t.nettotal1)||0,e.PaymentAmount=0;var l=(null===(a=r.data)||void 0===a||null===(a=a.result)||void 0===a||null===(a=a.data)||void 0===a||null===(a=a[0])||void 0===a?void 0:a.lastpaymentdetails)||[];l.forEach(t=>{const a=String(t.paymentamount).replace(/,/g,"");e.PaymentAmount+=Number(a)||0}),e.TotalDueAmount=(Number(e.finalAmount)||0)-e.PaymentAmount},async GetConfigurationValueBykey(){const t="configkey=PaymentLink";try{const a=await i["a"].GetBaseCurrency(t);this.PaymentLink=a.data.CONFIG_DATA_VALUE}catch(a){console.error(a)}},async CheckExtraFeatures(t){var a=this;const e="featureCode=GET_EXTRA_FEATURE_BILLING&outputType=list";try{const t=await i["a"].CheckExtraFeatures(e);if(t.data){const e=JSON.parse(t.data);e.forEach(t=>{"UTILITY_BILLING"===t.FEATURE_CODE?a.IsUtilityBilling="UTILITY":a.IsUtilityBilling="SUBSCRIPTION"})}}catch(s){console.log("Error checking extra features:",s)}},goToInvoiceListing(){this.$router.push("/ClientBill/InvoiceListing")},async GetClientBillingDetailsAndAddress(){const t=`clientId=${this.UserId}&projectId=`;try{const a=await i["a"].GetClientBillingDetailsAndAddress(t);a.data.Status}catch(a){console.error(a)}},async GetCompanyListing(){try{const t=await i["a"].GetCompanyList();this.companies=[];let a=t.data.result;"string"===typeof a&&(a=JSON.parse(a)),Array.isArray(a)&&a.length>0&&a.forEach(t=>{this.companies.push({name:t.COMPANY_NAME,value:t.COMPANY_ID})})}catch(t){this.companies=[],console.error(t)}},async GetActiveGatewayDetail(){try{var t,a=this;const e=await i["a"].GetActiveGatewayDetail();if(null!==(t=e.data)&&void 0!==t&&t.result){const t=JSON.parse(e.data.result);t.forEach(t=>{if(t.parameters)try{t.parameters=JSON.parse(t.parameters)}catch(a){console.warn("Invalid parameters JSON:",t.parameters),t.parameters={}}}),a.paymentGateways=t,a.paymentGateways.length>0&&(a.selectedGateway=a.paymentGateways[0].PaymentGatewayCode)}else a.paymentGateways=[]}catch(e){console.error("Error loading gateways:",e),a.paymentGateways=[]}},selectGateway(t){if(this.selectedGateway=t,"Wallet"===t){const t=this.paymentGateways.find(t=>"Wallet"===t.PaymentGatewayCode);t&&(this.walletBalance=t.WalletBalance)}},loadStripeScript(){return new Promise((t,a)=>{if(document.querySelector('script[src="https://js.stripe.com/v3/"]'))return void t();const e=document.createElement("script");e.src="https://js.stripe.com/v3/",e.onload=()=>t(),e.onerror=()=>a("Stripe failed to load"),document.head.appendChild(e)})},initializeStripe(){this.stripe=Stripe(this.stripePublishableKey),this.elements=this.stripe.elements();const t={base:{fontSize:"14px",color:"#212529","::placeholder":{color:"#888"}},invalid:{color:"#dc3545"}};this.cardNumber=this.elements.create("cardNumber",{style:t}),this.cardExpiry=this.elements.create("cardExpiry",{style:t}),this.cardCvc=this.elements.create("cardCvc",{style:t}),this.cardNumber.mount("#card-number-element"),this.cardExpiry.mount("#card-expiry-element"),this.cardCvc.mount("#card-cvc-element"),[this.cardNumber,this.cardExpiry,this.cardCvc].forEach(t=>{t.on("change",t=>{this.errorMessage=t.error?t.error.message:""})})},mapStripeError(t){const a={incomplete_number:"Please enter a complete card number.",invalid_number:"The card number you entered is invalid.",incomplete_cvc:"Please enter your card's CVC.",invalid_cvc:"The CVC code you entered is incorrect.",incomplete_expiry:"Please enter the full expiration date.",invalid_expiry_year_past:"Your card's expiration year is in the past.",card_declined:"Your card was declined. Please try another payment method.",expired_card:"Your card has expired."};return a[t.code]||t.message||"Something went wrong."},async payNow(){var t,a=this;if(a.TotalDueAmount<0)return void a.ShowAlert("Remaining amount cannot be negative.","failure",!0,"Alert");if(0===a.TotalDueAmount)return void a.ShowAlert("Remaining amount should be positive.","failure",!0,"Alert");if(a.isLoading=!0,"p"===a.paymentType&&(a.validateAmount(),a.errorMessage))return void(a.isLoading=!1);null===(t=a.templatedata[0])||void 0===t||t.nettotal1;if("Wallet"===a.selectedGateway){a=this;var e,s,r,l,n={TransactionId:(null===(e=a.TransactionId)||void 0===e?void 0:e.toString())||"0",UniqueId:a.UniqueId||"",CompanyName:(null===(s=a.templatedata[0])||void 0===s?void 0:s.companyname)||"",CustomerId:(null===(r=a.templatedata[0])||void 0===r?void 0:r.Customer_id)||"",InvoiceId:a.BillId,NetAmount:a.TotalDueAmount,PaidAmount:"f"===a.paymentType?a.TotalDueAmount:a.paymentAmount,PaymentGatewayCode:a.selectedGateway,Description:"BILL_PAYMENT",PaymentType:a.paymentType,firstname:(null===(l=a.templatedata[0])||void 0===l?void 0:l.clientname)||""};a.confirmR(a.$t("Do You Want To Proceed With Payment ?"),!0,a.$t("Proceed With Payment"),(function(){a.isLoading=!0;var t=JSON.stringify(n);i["a"].MakeRealPartialpayment(t).then((function(t){if(a.isLoading=!1,t.data&&t.data.result){var e=t.data.result,s=JSON.parse(e);if(s&&"3"===s.CODE)a.isLoading=!1,a.walletBalance=s.wallet_current_balance,a.ShowAlert(a.$t(s.MSG||"Balance Not Available"),"failure",!0,a.$t("Alert"));else if(t.data.redirectUrl){const a=t.data.redirectUrl;window.location.href=a}else a.ShowAlert(a.$t("UnknownErrorOccur"),"failure",!0,a.$t("Alert"))}else a.ShowAlert(a.$t("UnknownErrorOccur"),"failure",!0,a.$t("Alert"))})).catch((function(t){a.isLoading=!1,a.ShowAlert(a.$t("UnknownErrorOccur"),"failure",!0,a.$t("Alert"))}))})),a.isLoading=!1}else{if("PayU"===a.selectedGateway){var o,c,d,m,u,p,v,y={txnid:(null===(o=a.TransactionId)||void 0===o?void 0:o.toString())||"0",udf1:a.UniqueId||"",amount:"p"===a.paymentType?null===(c=a.paymentAmount)||void 0===c?void 0:c.toString():(null===(d=a.TotalDueAmount)||void 0===d?void 0:d.toString())||"0",productinfo:"BILL_PAYMENT",firstname:(null===(m=a.templatedata[0])||void 0===m?void 0:m.clientname)||"",email:(null===(u=a.templatedata[0])||void 0===u?void 0:u.email_id)||"",phonenumber:(null===(p=a.templatedata[0])||void 0===p?void 0:p.phone)||"",udf2:(null===(v=a.templatedata[0])||void 0===v?void 0:v.billId)||"",udf3:a.selectedGateway};return void i["a"].MakeRealPartialpaymentPAYU(y).then((function(t){a.isLoading=!1,t.data&&"string"===typeof t.data?window.location.href=t.data:a.ShowAlert(a.$t("UnknownErrorOccur"),"failure",!0,a.$t("Alert"))}))}if("Razorpay"===a.selectedGateway){var h,f,C,g,_,w,b={amount:"p"===a.paymentType?null===(h=a.paymentAmount)||void 0===h?void 0:h.toString():(null===(f=a.TotalDueAmount)||void 0===f?void 0:f.toString())||"0",currency:"USD",name:(null===(C=a.templatedata[0])||void 0===C?void 0:C.clientname)||"",email:(null===(g=a.templatedata[0])||void 0===g?void 0:g.email_id)||"",transactionId:(null===(_=a.TransactionId)||void 0===_?void 0:_.toString())||"0",notes:"BILL_PAYMENT",invoice_id:a.BillId,user_id:a.GetUserInfo.ID,company_id:a.GetUserInfo.CompanyId,reference_no:(null===(w=a.UniqueId)||void 0===w?void 0:w.toString())||"0",BillIdEnc:a.BillIdEnc};a.$router.push({name:"RazorpayCheckout",params:{razorpayData:b}})}else{if("Stripe"===a.selectedGateway){var x,A,I;const{token:t,error:e}=await a.stripe.createToken(a.cardNumber,{name:a.billingDetails.name});if(e)return a.errorMessage=a.mapStripeError(e),void(a.isLoading=!1);a.$refs.stripeToken.value=t.id,a.$refs.hdnCardType.value=t.card.brand,a.$refs.hdnNameonCard.value=t.card.name,a.$refs.hdnCardNumber.value=t.card.last4,a.$refs.hdnCardMonth.value=t.card.exp_month,a.$refs.hdnCardYear.value=t.card.exp_year,a.$refs.hdnCvv.value=123;var T={CardMonth:a.$refs.hdnCardMonth.value,CardNum:a.$refs.hdnCardNumber.value,CardType:a.$refs.hdnCardType.value,CardYear:a.$refs.hdnCardYear.value,CompanyName:(null===(x=a.templatedata[0])||void 0===x?void 0:x.companyname)||"",CustomerId:"",InvoiceId:a.BillId,NameOnCard:a.$refs.hdnNameonCard.value,NetAmount:a.TotalDueAmount,PaidAmount:"f"===a.paymentType?a.TotalDueAmount:a.paymentAmount,PaymentGatewayCode:"Stripe",RefId:(null===(A=a.templatedata[0])||void 0===A?void 0:A.ref_id)||"",BillIdEnc:(null===(I=a.templatedata[0])||void 0===I?void 0:I.ref_id)||"",Description:"BILL_PAYMENT",StripeToken:a.$refs.stripeToken.value,UniqueId:a.UniqueId,TransactionId:a.TransactionId,ClientEmail:a.ClientEmail},E=JSON.stringify(T);return i["a"].MakeRealPartialpayment(E).then((function(t){a.isLoading=!1,1==t.data.status?(a.ShowAlert(a.$t("AddedSuccess",[a.$t("Payment")]),"success",!0,a.$t("Alert")),a.$router.push({name:"InvoiceDetail"})):2==t.data.status?a.ShowAlert(a.$t("InvalidLoginCredentials"),"failure",!0,a.$t("Alert")):a.ShowAlert(a.$t("UnknownErrorOccur"),"failure",!0,a.$t("Alert"))})),void(a.isLoading=!1)}{var $,P,G,N;let t=!0;if(this.card.cardType||(this.cardErrors.cardType="Card type is required.",t=!1),this.card.number?/^\d{13,19}$/.test(this.card.number)||(this.cardErrors.number="Invalid card number.",t=!1):(this.cardErrors.number="Card number is required.",t=!1),this.card.name||(this.cardErrors.name="Name on card is required.",t=!1),this.card.expMonth||(this.cardErrors.expMonth="Expiration month is required.",t=!1),this.card.expYear||(this.cardErrors.expYear="Expiration year is required.",t=!1),!t)return;T={CardMonth:a.card.expMonth,CardNum:a.card.number,CardType:a.card.cardType,CardYear:a.card.expYear,CompanyName:(null===($=a.templatedata[0])||void 0===$?void 0:$.companyname)||"",CustomerId:(null===(P=a.templatedata[0])||void 0===P?void 0:P.Customer_id)||"",InvoiceId:a.BillId,NameOnCard:a.card.name,NetAmount:this.TotalDueAmount,PaidAmount:"f"===a.paymentType?a.TotalDueAmount:a.paymentAmount,PaymentGatewayCode:a.selectedGateway,RefId:(null===(G=a.templatedata[0])||void 0===G?void 0:G.ref_id)||"",BillIdEnc:(null===(N=a.templatedata[0])||void 0===N?void 0:N.ref_id)||"",Description:"BILL_PAYMENT",StripeToken:null,UniqueId:a.UniqueId,TransactionId:a.TransactionId,ClientEmail:a.ClientEmail};i["a"].MakeRealPartialpayment(JSON.stringify(T)).then((function(t){a.isLoading=!1,1==t.data.status?(a.ShowAlert(a.$t("AddedSuccess",[a.$t("Payment")]),"success",!0,a.$t("Alert")),a.$router.push({name:"InvoiceDetail"})):2==t.data.status?a.ShowAlert(a.$t("InvalidLoginCredentials"),"failure",!0,a.$t("Alert")):a.ShowAlert(a.$t("UnknownErrorOccur"),"failure",!0,a.$t("Alert"))}))}}}},async AddPaymentTranaction(){var t,a,e=this;const s=(null===(t=e.templatedata[0])||void 0===t?void 0:t.nettotal1)||0,r="p"===e.paymentType?(null===(a=e.paymentAmount)||void 0===a?void 0:a.toString())||"0":(null===s||void 0===s?void 0:s.toString())||"0",l=`Amount=${r}&Description=BILL_PAYMENT`,n=await i["a"].AddPaymentTranaction(l);return n.data?(e.UniqueId=n.data[0].UniqueId,e.TransactionId=n.data[0].TransactionId,{TransactionId:n.data[0].TransactionId,UniqueId:n.data[0].UniqueId}):null}}},n=l,o=(e("0b57"),e("2877")),c=Object(o["a"])(n,s,r,!1,null,null,null);a["default"]=c.exports},"9fcf":function(t,a,e){var s=e("b89a");s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);var r=e("499e").default;r("69d6adb0",s,!0,{sourceMap:!1,shadowMode:!1})},b89a:function(t,a,e){var s=e("4bad");a=s(!1),a.push([t.i,".form-check-input{left:22px}",""]),t.exports=a}}]);
//# sourceMappingURL=chunk-28b708b3.js.map