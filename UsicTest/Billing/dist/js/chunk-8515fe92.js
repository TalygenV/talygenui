(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-8515fe92"],{"3b1ba":function(e,t,a){var s=a("b25d");s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);var n=a("499e").default;n("4061edc6",s,!0,{sourceMap:!1,shadowMode:!1})},"3df7":function(e,t,a){"use strict";a("3b1ba")},b25d:function(e,t,a){var s=a("24fb");t=s(!1),t.push([e.i,".modal .btn.active[data-v-a89a9648]{border:2px solid #007bff;font-weight:700}img[data-v-a89a9648]{max-height:24px}",""]),e.exports=t},f75f:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",[a("loader",{attrs:{"is-visible":e.isLoading}}),a("div",{staticClass:"ticketsmallfix theme-primary partition p-actions-expand mt-2",staticStyle:{overflow:"visible"}},[a("span",{staticClass:"p-name text-white"},[e._v(e._s(e.$t("AddIntegration")))]),a("span",{staticClass:"p-actions float-right",on:{click:e.openModal}},[a("a",{staticClass:"p-action-btn text-white ",attrs:{title:"Add Integration",href:"javascript:;"}},[a("em",{staticClass:"fa fa fa-plus"}),e._v(" "),a("br"),a("span",[e._v(e._s(e.$t("Add")))])])])]),a("tg-list",{attrs:{IsShowAction:!0,showCheckBox:!1,ModuleName:"Billing",listType:["List"],RenderRowActionMethod:e.renderActions,SubModuleCode:"Billing",IdentityColumn:"id",ListData:e.OuthList,HeaderData:e.Headers,callbackfunction:e.FetchData,HeaderButtons:e.listheaderbuttons,TotalRecords:e.TotalRecords,ListDataCallBackFunction:e.FetchData,LegendArray:[],SortExp:e.sortExp,SortBy:e.sortBy,NorecordfoundText:e.$t("NoRecordfound"),isShowHeaderText:!0,HeaderText:e.$t("RateSchedulede")},on:{LeftsearchButtonClick:function(e){},PagerButtonClick:e.pagerMethod,ActionButtonClick:e.actionButtonClick,HeaderButtonClick:e.commonHeaderButtonClick,SortdataButtonClick:e.sortdata},scopedSlots:e._u([{key:"slotdata",fn:function(t){var s=t.data;return["created_at"==s.column.COLUMN_NAME?[s.row.created_at?a("td",{staticClass:"text-center single-action tourguide_a"},[e._v(" "+e._s(e.$d(s.row.created_at))+" ")]):e._e()]:e._e(),"status_id"==s.column.COLUMN_NAME?[1001==s.row.status_id?a("span",{staticClass:"px-2 text-center text-white d-block bg-success"},[e._v(" "+e._s(e.$t("Active"))+" ")]):e._e()]:e._e(),"TenantName"==s.column.COLUMN_NAME?[a("span",[e._v(e._s(s.row.TenantName?s.row.TenantName:"--"))])]:e._e()]}}])}),e.IsAccountintegration?a("IntegrateAccount",{attrs:{AccessToken:e.AccessToken},on:{"drive-selected":e.onDriveSelected,"integration-complete":e.FetchData}}):e._e(),e.IsTenantPopup?a("TenantPopup",{attrs:{TenantData:e.TenantData}}):e._e()],1)},n=[],i=(a("14d9"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"my-popups"},[a("loader",{attrs:{"is-visible":e.isLoading}}),a("div",{staticClass:"modal d-block"},[a("div",{staticClass:"modal-dialog modal-dialog-centered"},[a("div",{staticClass:"modal-content"},[a("div",{staticClass:"modal-header theme-primary partition-full d-flex"},[a("h4",{staticClass:"modal-title"},[e._v(e._s(e.$t("SelectOrganization")))]),a("button",{staticClass:"close",attrs:{type:"button"},on:{click:e.Close}},[a("em",{staticClass:"fa fa-times",attrs:{"aria-hidden":"true"}})])]),a("div",{staticClass:"modal-body"},[a("div",{staticClass:"row"},e._l(e.TenantObjectData,(function(t){return a("div",{key:t.TenantId,staticClass:"form-group d-flex flex-column align-items-start mb-4 col-md-4"},[a("label",{staticClass:"mr-2"},[e._v(e._s(t.TenantName))]),a("label",{staticClass:"switch"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.selected,expression:"item.selected"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(t.selected)?e._i(t.selected,null)>-1:t.selected},on:{change:[function(a){var s=t.selected,n=a.target,i=!!n.checked;if(Array.isArray(s)){var r=null,o=e._i(s,r);n.checked?o<0&&e.$set(t,"selected",s.concat([r])):o>-1&&e.$set(t,"selected",s.slice(0,o).concat(s.slice(o+1)))}else e.$set(t,"selected",i)},function(a){return e.onToggleChange(t)}]}}),e._m(0,!0)])])})),0),a("div",{staticClass:"mt-3 d-flex justify-content-end"},[a("button",{staticClass:"btn btn-success mr-2",on:{click:e.onSubmit}},[a("em",{staticClass:"fa fa-save pr-2"}),e._v(e._s(e.$t("Save"))+" ")]),a("button",{staticClass:"btn btn-danger",on:{click:e.Close}},[a("em",{staticClass:"fa fa-close pr-2"}),e._v(e._s(e.$t("Close"))+" ")])])])])])])],1)}),r=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("span",{staticClass:"slider round"},[a("span",{staticClass:"slider-yes"},[e._v("Yes")]),a("span",{staticClass:"slider-no"},[e._v("No")])])}],o=a("9769"),c={props:{TenantData:{type:Array,required:!0}},data(){return{isLoading:!1,toggleSelected:!1,TenantObjectData:[],XeroId:""}},created(){var e=this;e.TenantObjectData=JSON.parse(e.TenantData.filePath),e.XeroId=e.TenantData.code},methods:{onToggleChange(e){var t=this;t.TenantObjectData.forEach(t=>{t.selected=t===e})},async onSubmit(){var e=this,t=e.TenantObjectData.find(e=>e.selected),a=`id=${e.XeroId}&tenantid=${t.TenantId}`;await o["a"].SaveTenant(a).then(t=>{"Success"==t.data.status&&(e.ShowAlert(e.$t("OrganizationSaved"),"success",!0,e.$t("Alert")),e.Close(),e.$parent.FetchData())})},Close(){this.$parent.IsTenantPopup=!1}}},l=c,d=a("0c7c"),u=Object(d["a"])(l,i,r,!1,null,null,null),h=u.exports,p=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"my-popups"},[a("div",{staticClass:"modal d-block"},[a("div",{staticClass:"modal-dialog modal-dialog-centered ui-draggable"},[a("loader",{attrs:{"is-visible":e.isLoading}}),a("div",{staticClass:"modal-content"},[a("div",{staticClass:"modal-header ui-draggable-handle"},[a("h4",{staticClass:"modal-title"},[e._v(e._s(e.$t("IntegrateAccount")))]),a("button",{staticClass:"close",on:{click:e.ClosePopup}},[a("em",{staticClass:"fa fa-times",attrs:{"aria-hidden":"true"}})])]),a("div",{staticClass:"modal-body"},[a("Form",{ref:"IntegrateAccount"},[e.IsWorkDay?e._e():a("div",{staticClass:"row"},e._l(e.driveOptions,(function(t){return a("div",{key:t.Name,staticClass:"col-lg-4 mb-3 text-center"},[a("button",{staticClass:"btn btn-outline-primary w-100 d-flex align-items-center justify-content-center py-2",class:{active:e.drive===t.Name},on:{click:function(a){return e.SelectDrive(t.Name)}}},[a("img",{staticStyle:{height:"24px","margin-right":"8px"},attrs:{src:t.logo,alt:""}}),a("span",[e._v(e._s(t.Name))])])])})),0),e.IsWorkDay?a("div",{staticClass:"row"},[a("div",{staticClass:"col-lg-6"},[a("Field",{attrs:{name:"client Id",rules:{required:!0}},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.errors;return[a("div",{staticClass:"form-group"},[a("label",[e._v(e._s(e.$t("ClientID"))+":")]),a("span",{staticClass:"text-danger"},[e._v("*")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.WD_clientId,expression:"WD_clientId"}],staticClass:"form-control",class:{"is-invalid":s[0]},attrs:{type:"text"},domProps:{value:e.WD_clientId},on:{input:function(t){t.target.composing||(e.WD_clientId=t.target.value)}}}),s[0]?a("span",{staticClass:"invalid-feedback d-block"},[e._v(e._s(s[0]))]):e._e()])]}}],null,!1,570560159)})],1),a("div",{staticClass:"col-lg-6"},[a("Field",{attrs:{name:"Client Secrat",rules:{required:!0}},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.errors;return[a("div",{staticClass:"form-group"},[a("label",[e._v(e._s(e.$t("ClientSecret"))+":")]),a("span",{staticClass:"text-danger"},[e._v("*")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.WD_ClientSecrat,expression:"WD_ClientSecrat"}],staticClass:"form-control",class:{"is-invalid":s[0]},attrs:{type:"text"},domProps:{value:e.WD_ClientSecrat},on:{input:function(t){t.target.composing||(e.WD_ClientSecrat=t.target.value)}}}),s[0]?a("span",{staticClass:"invalid-feedback d-block"},[e._v(e._s(s[0]))]):e._e()])]}}],null,!1,734911620)})],1),a("div",{staticClass:"col-lg-6"},[a("Field",{attrs:{name:"redirect Uri",rules:{required:!0}},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.errors;return[a("div",{staticClass:"form-group"},[a("label",[e._v(e._s(e.$t("RedirectURI"))+":")]),a("span",{staticClass:"text-danger"},[e._v("*")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.WD_redirectUri,expression:"WD_redirectUri"}],staticClass:"form-control",class:{"is-invalid":s[0]},attrs:{type:"text"},domProps:{value:e.WD_redirectUri},on:{input:function(t){t.target.composing||(e.WD_redirectUri=t.target.value)}}}),s[0]?a("span",{staticClass:"invalid-feedback d-block"},[e._v(e._s(s[0]))]):e._e()])]}}],null,!1,3629335743)})],1)]):e._e()])],1),e.IsWorkDay?a("div",{staticClass:"modal-footer text-right"},[a("button",{staticClass:"btn btn-success",on:{click:e.IntegrateAccount}},[a("em",{staticClass:"fa fa-floppy-o pr-2"}),e._v(" "+e._s(e.$t("Save"))+" ")]),a("button",{staticClass:"btn btn-danger",on:{click:e.ClosePopup}},[a("em",{staticClass:"fa fa-times pr-2",attrs:{"aria-hidden":"true"}}),e._v(" "+e._s(e.$t("Cancel"))+" ")])]):e._e()])],1)])])},f=[],m=(a("88a7"),a("271a"),a("5494"),{props:{AccessToken:{type:[String,Boolean],required:!1}},data(){return{Name:"",drive:"",isLoading:!1,clientId:"",ClientSecrat:"",Redirect_Uri:"https://stage.talygen.com/Billing/IntegrateAccount",WD_clientId:"",WD_ClientSecrat:"",WD_redirectUri:"",Webhooks_key:"",xero_ClientSecrat:"",xero_clientId:"",EndAddress:"",username:"",password:"",driveOptions:[],IsWorkDay:!1,IsXero:!1,driveName:"",AccessTokens:"",AccessTokenExpiresAt:"",RefreshToken:"",RefreshTokenExpiresAt:"",ModifiedAt:"",XeroTokenJson:""}},created:async function(){var e=this;e.GetIntegrationData()},methods:{ClosePopup(){this.$parent.IsAccountintegration=!1},async GetIntegrationData(e){var t=this;await o["a"].GetIntegrationDetail().then(e=>{e.data&&(t.driveOptions=e.data,t.driveOptions.forEach(e=>{"Xero"==e.Name&&(t.xero_clientId=e.client_id,t.xero_ClientSecrat=e.client_secret,t.xero_redirect_uri=e.redirect_uri,t.Webhooks_key=e.Webhooks_Key)}))})},async IntegrateAccount(){this.isLoading=!0;var e=this,t="";e.IsWorkDay?t="WorkDay":e.IsXero&&(t="Xero"),e.$refs.IntegrateAccount.validate().then(async a=>{if(a){var s="";if("WorkDay"===t)s=`DriveName=${t}&logo=&ClientId=${e.WD_clientId}&ClientSecret=${e.WD_ClientSecrat}&CallbackUri=${e.Redirect_Uri}&Name=${t}&WebhooksKey=${e.Webhooks_key}&EndAddress=${e.EndAddress}&username=${e.username}&password=${e.password}&AccessToken=${e.AccessTokens}&AccessTokenExpiresAt=${e.AccessTokenExpiresAt}&RefreshToken=${e.RefreshToken}&RefreshTokenExpiresAt=${e.RefreshTokenExpiresAt}&ModifiedAt=${e.ModifiedAt}&XeroTokenJson=${e.XeroTokenJson}`;else if("Xero"===t)s=`DriveName=${t}&logo=&ClientId=${e.xero_clientId}&ClientSecret=${e.xero_ClientSecrat}&CallbackUri=${e.Redirect_Uri}&Name=${t}&WebhooksKey=${encodeURIComponent(e.Webhooks_key)}&EndAddress=${e.EndAddress}&username=${e.username}&password=${e.password}&AccessToken=${e.AccessTokens}&AccessTokenExpiresAt=${e.AccessTokenExpiresAt}&RefreshToken=${e.RefreshToken}&RefreshTokenExpiresAt=${e.RefreshTokenExpiresAt}&ModifiedAt=${e.ModifiedAt}&XeroTokenJson=${e.XeroTokenJson}`;await o["a"].SaveDriveCredential(s).then(async t=>{if("Success"===t.data.Status){let a=t.data.Result,s=JSON.parse(a),n=s.CODE;1==n?(e.ShowAlert(e.$t("AddedSuccess",[e.$t("Integration")]),"Success",!0,e.$t("Alert")),e.ClosePopup(),e.$parent.FetchData()):2==n&&e.ShowAlert(e.driveName+" Account Already Integrated","warning",e.$t("Alert"))}})}}),this.isLoading=!1},async SelectDrive(e){const t=this;if(this.drive=e,this.driveName=e,this.$emit("drive-selected",this.driveName),"Talygen"===e){const a=`DriveName=${e}&logo=&ClientId=&ClientSecret=&CallbackUri=&Name=`;await o["a"].SaveDriveCredential(a).then(a=>{if("Success"===a.data.Status){const s=JSON.parse(a.data.Result),n=s.CODE;t.confirmR(t.$t(`Are you sure you want to save ${e} record(s)?`),!0,!1,(function(){1===n?(t.ShowAlert(t.$t("AddedSuccess",[t.$t("Integration")]),"Success",!0,t.$t("Alert")),t.ClosePopup(),t.$parent.FetchData()):2===n&&t.ShowAlert(t.driveName+" Account Already Integrated","warning",t.$t("Alert"))}))}})}else if("Xero"===e){const e=new URL("https://login.xero.com/identity/connect/authorize");e.searchParams.set("response_type","code"),e.searchParams.set("client_id",t.xero_clientId),e.searchParams.set("redirect_uri",t.xero_redirect_uri),e.searchParams.set("scope","openid profile email offline_access accounting.transactions accounting.attachments accounting.contacts"),e.searchParams.set("state","xyz123"),window.location.href=e.toString()}else"Workday"===e&&(t.IsWorkDay=!0)}}}),v=m,_=(a("3df7"),Object(d["a"])(v,p,f,!1,null,"a89a9648",null)),g=_.exports,C={components:{IntegrateAccount:g,TenantPopup:h},data(){return{IsTenantPopup:!1,IsAccountintegration:!1,OuthList:[],TotalRecords:0,pageSize:10,pageNum:1,sortBy:"",CurrentPage:1,TotalPages:0,sortExp:"",noRecords:!1,Headers:[{COLUMN_NAME:"name",DATA_TYPE:"text",SORTABLE:!0,VISIBLE:!0,DISPLAY_NAME:"name",DISPLAY_ORDER:1},{COLUMN_NAME:"TenantName",DATA_TYPE:"text",SORTABLE:!0,VISIBLE:!0,DISPLAY_NAME:"tenantname",DISPLAY_ORDER:2},{COLUMN_NAME:"created_at",DATA_TYPE:"text",SORTABLE:!0,VISIBLE:!0,DISPLAY_NAME:"CreatedAt",DISPLAY_ORDER:3},{COLUMN_NAME:"status_id",DATA_TYPE:"text",SORTABLE:!0,VISIBLE:!0,DISPLAY_NAME:"Status",DISPLAY_ORDER:4}],listActions:[{title:"Refresh",href:"javascript:void(0)",icon:"text-success fa fa-refresh ",callbackfunction:"Refreshtoken",additionalSpan:""},{title:"Delete",href:"javascript:void(0)",icon:"text-success fa fa-trash ",callbackfunction:"delete",additionalSpan:""}],userId:this.GetUserInfo.ID,companyId:this.GetUserInfo.CompanyId,isLoading:!1,AccessToken:"",clientId:"",ClientSecrat:"",redirectUri:"",Webhookskey:"",selectedDriveName:"",TenantData:[]}},created:async function(){var e=this;e.FetchData(),await e.GetIntegrationData(),e.AccessToken=e.$route.query.code,e.AccessToken&&await e.SaveXeroCredentials(e.AccessToken)},methods:{async GetIntegrationData(e){var t=this;await o["a"].GetIntegrationDetail().then(e=>{e.data&&(t.driveOptions=e.data,t.driveOptions.forEach(e=>{"Xero"==e.Name&&(t.ClientId=e.client_id,t.ClientSecrat=e.client_secret,t.redirectUri=e.redirect_uri,t.Webhookskey=e.Webhooks_Key)}))})},getTenantName(e,t){try{const a=e.find(e=>e.TenantId===t);return a?a.TenantName:""}catch(a){return console.error("Error parsing row:",a),""}},openTenantPopup(e){var t=this;t.TenantData=e,t.IsTenantPopup=!0},openModal(){this.IsAccountintegration=!0},async SaveXeroCredentials(){var e=this;this.isLoading=!0;var t=`code=${e.AccessToken}&state=US&name=Xero&ClientId=${e.ClientId}&ClientSecret=${e.ClientSecrat}&CallbackUri=${e.redirectUri}&WebhooksKey=${encodeURIComponent(e.Webhookskey)}`;await o["a"].SaveToken(t).then(t=>{if("Success"==t.data.status){if(this.ShowAlert(this.$t("AddedSuccess",[this.$t("Integration")]),"Success",!0,this.$t("Alert")),e.FetchData(),t.data.code&&t.data.filePath&&t.data.filePath.length>1){const a={filePath:t.data.filePath,code:t.data.code};e.openTenantPopup(a)}}else 2==parsedData.code&&this.ShowAlert(this.driveName+" Account Already Integrated","warning",this.$t("Alert"))}),this.isLoading=!1},onDriveSelected(e){this.selectedDriveName=e},async FetchData(){var e=this;this.isLoading=!0;const t=this.selectedDriveName;try{const a="TypeCode="+t;await o["a"].GetIntegrationList(a).then(t=>{e.Headers.forEach(e=>{e.settings=null,["created_at","status_id","TenantName"].includes(e.COLUMN_NAME)&&(e.settings={isInSlot:!0})});const a=t.data;if(a.forEach(t=>{t.TenantName=t.TenantId?e.getTenantName(JSON.parse(t.TenantJson),t.TenantId):null,t.created_at&&(t.created_at=new Date(t.created_at))}),a[0]&&(null==a[0].TenantId||""==a[0].TenantId)&&1001==a[0].status_id&&"Xero"==a[0].name&&a[0].TenantJson&&a[0].TenantJson.length>1){const t={filePath:a[0].TenantJson,code:a[0].id};e.openTenantPopup(t)}t.data.length>0?(this.OuthList=a,this.TotalPages=Math.ceil(this.TotalRecords/this.pageSize),this.CurrentPage=this.pageNum,this.noRecord=!1):(this.noRecord=!0,this.TotalRecords=0,this.OuthList=[])})}catch(a){console.error("Error fetching data:",a)}this.isLoading=!1},actionButtonClick(e,t,a,s){switch(e){case"Refreshtoken":this.callRefreshtoken(t,a);break;case"delete":this.delete(t,a);break}},renderActions(e){var t=this;let a=[];return t.listActions.forEach(e=>{let t={...e};switch(t.title){case"Refresh":t.isVisible=!0;break;case"Delete":t.isVisible=!0;break}a.push(t)}),a},async callRefreshtoken(e){var t=this;this.isLoading=!0;var a="id="+e.id;await o["a"].RefreshToken(a).then(e=>{if("Success"==e.data.status){if(t.ShowAlert(t.$t("TokenRefreshSuccess"),"Success",!0,t.$t("Alert")),t.FetchData(),e.data.code&&e.data.filePath&&e.data.filePath.length>1){const a={filePath:e.data.filePath,code:e.data.code};t.openTenantPopup(a)}}else"Error"==e.data.status?t.ShowAlert(e.data.message,"failure",!0,t.$t("Alert")):t.ShowAlert(t.$t("UnknownErrorOccur"),"failure",!0,t.$t("Alert"))}),this.isLoading=!1},async delete(e){var t=this;this.isLoading=!0;var a=`companyId=${e.company_id}&userId=${e.created_by}&id=${e.id}`;await o["a"].DeleteIntegration(a).then(e=>{const a=e.data.Result,s=JSON.parse(a),n=s[0],i=JSON.parse(n);1==i.code&&(t.ShowAlert(t.$t("DeletedSuccessfully"),"Success",!0,t.$t("Alert")),t.FetchData())}),this.isLoading=!1}}},A=C,k=Object(d["a"])(A,s,n,!1,null,null,null);t["default"]=k.exports}}]);
//# sourceMappingURL=chunk-8515fe92.js.map